"use strict";
(function iife() {
  const platformExportObj = (function detectPlatformExportObj() {
    if (typeof module !== 'undefined' && module.exports) {
      return module.exports;  // node
    } else if (typeof window !== 'undefined') {
      return window;  // browser
    }
    throw new Error('Could not detect platform global object (no window or module.exports)');
  })();
const isBrowser = typeof window !== 'undefined';
const b64Encode = isBrowser ? btoa : require('base-64').encode;
const b64Decode = isBrowser ? atob : require('base-64').decode;
const URL = isBrowser ? window.URL : require('url').URL;
class ShadowsocksConfigError extends Error {
    constructor(message) {
        super(message);
        Object.setPrototypeOf(this, new.target.prototype);
        this.name = new.target.name;
    }
}
platformExportObj.ShadowsocksConfigError = ShadowsocksConfigError;
class InvalidConfigField extends ShadowsocksConfigError {
    constructor(message) {
        super(message);
        this.message = message;
    }
}
platformExportObj.InvalidConfigField = InvalidConfigField;
class InvalidURI extends ShadowsocksConfigError {
    constructor(message) {
        super(message);
        this.message = message;
    }
}
platformExportObj.InvalidURI = InvalidURI;
class ConfigField {
    constructor(data) {
        this.data = data;
    }
    toString() {
        return this.data.toString();
    }
}
platformExportObj.ConfigField = ConfigField;
function throwErrorForInvalidField(name, value) {
    throw new InvalidConfigField(`Invalid ${name}: ${value}`);
}
class Host extends ConfigField {
    constructor(host) {
        if (host instanceof Host) {
            host = host.data;
        }
        try {
            const urlParserResult = new URL(`http://${host}/`);
            super(urlParserResult.hostname);
        }
        catch (_) {
            throwErrorForInvalidField('host', host);
        }
    }
}
platformExportObj.Host = Host;
class Port extends ConfigField {
    constructor(port) {
        if (port instanceof Port) {
            port = port.data;
        }
        const throwError = () => throwErrorForInvalidField('port', port);
        if (port === '')
            throwError();
        try {
            const urlParserResult = new URL(`http://0.0.0.0:${port}/`);
            super(urlParserResult.port);
        }
        catch (_) {
            throwError();
        }
    }
}
platformExportObj.Port = Port;
class Method extends ConfigField {
    constructor(method) {
        if (method instanceof Method) {
            method = method.data;
        }
        super(method);
        if (!Method.METHODS.has(method)) {
            throwErrorForInvalidField('method', method);
        }
    }
}
Method.METHODS = new Set([
    'rc4-md5',
    'aes-128-gcm',
    'aes-192-gcm',
    'aes-256-gcm',
    'aes-128-cfb',
    'aes-192-cfb',
    'aes-256-cfb',
    'aes-128-ctr',
    'aes-192-ctr',
    'aes-256-ctr',
    'camellia-128-cfb',
    'camellia-192-cfb',
    'camellia-256-cfb',
    'bf-cfb',
    'chacha20-ietf-poly1305',
    'salsa20',
    'chacha20',
    'chacha20-ietf',
]);
platformExportObj.Method = Method;
class Password extends ConfigField {
    constructor(password) {
        super((password instanceof Password ? password.data : password) || '');
    }
}
platformExportObj.Password = Password;
class Tag extends ConfigField {
    constructor(tag) {
        super((tag instanceof Tag ? tag.data : tag) || '');
    }
}
platformExportObj.Tag = Tag;
class Plugin extends ConfigField {
    constructor(plugin) {
        super((plugin instanceof Plugin ? plugin.data : plugin) || '');
    }
}
platformExportObj.Plugin = Plugin;
class Config {
    constructor(config) {
        this.host = config.host;
        this.port = config.port;
        this.method = config.method;
        this.password = config.password;
        this.tag = config.tag;
    }
    set host(host) {
        this.host_ = new Host(host);
    }
    set port(port) {
        this.port_ = new Port(port);
    }
    set method(method) {
        this.method_ = new Method(method);
    }
    set password(password) {
        this.password_ = new Password(password);
    }
    set tag(tag) {
        this.tag_ = new Tag(tag);
    }
    get host() {
        return this.host_.toString();
    }
    get port() {
        return this.port_.toString();
    }
    get method() {
        return this.method_.toString();
    }
    get password() {
        return this.password_.toString();
    }
    get tag() {
        return this.tag_.toString();
    }
}
platformExportObj.Config = Config;
class ShadowsocksURI extends Config {
    constructor(config) {
        super(new Config(config));
    }
    static validateProtocol(uri) {
        if (!uri.startsWith('ss://')) {
            throw new InvalidURI(`URI must start with "ss://": ${uri}`);
        }
    }
    static getHash(config) {
        const tag = config.tag instanceof Tag ? config.tag.data : config.tag;
        return tag ? `#${encodeURIComponent(tag)}` : '';
    }
    static parse(uri) {
        let error;
        for (const UriType of [LegacyBase64URI, Sip002URI]) {
            try {
                return UriType.parse(uri);
            }
            catch (e) {
                error = error || e;
            }
        }
        if (!(error instanceof InvalidURI)) {
            const originalErrorName = error.name || '(Unnamed Error)';
            const originalErrorMessage = error.message || '(no error message provided)';
            const originalErrorString = `${originalErrorName}: ${originalErrorMessage}`;
            const newErrorMessage = `Invalid input: ${uri} - Original error: ${originalErrorString}`;
            error = new InvalidURI(newErrorMessage);
        }
        throw error;
    }
}
platformExportObj.ShadowsocksURI = ShadowsocksURI;
class LegacyBase64URI extends ShadowsocksURI {
    constructor(config) {
        super(new Config(config));
        const { method, password, host, port } = this;
        const b64EncodedData = b64Encode(`${method}:${password}@${host}:${port}`);
        const dataLength = b64EncodedData.length;
        let paddingLength = 0;
        for (; b64EncodedData[dataLength - 1 - paddingLength] === '='; paddingLength++)
            ;
        this.b64EncodedData = paddingLength === 0 ? b64EncodedData :
            b64EncodedData.substring(0, dataLength - paddingLength);
    }
    static parse(uri) {
        ShadowsocksURI.validateProtocol(uri);
        const hashIndex = uri.indexOf('#');
        let b64EndIndex = hashIndex;
        let tagStartIndex = hashIndex + 1;
        if (hashIndex === -1) {
            b64EndIndex = tagStartIndex = uri.length;
        }
        const tag = new Tag(decodeURIComponent(uri.substring(tagStartIndex)));
        const b64EncodedData = uri.substring('ss://'.length, b64EndIndex);
        const b64DecodedData = b64Decode(b64EncodedData);
        const atSignIndex = b64DecodedData.indexOf('@');
        if (atSignIndex === -1) {
            throw new InvalidURI(`Missing "@": ${b64DecodedData}`);
        }
        const methodAndPassword = b64DecodedData.substring(0, atSignIndex);
        const methodEndIndex = methodAndPassword.indexOf(':');
        if (methodEndIndex === -1) {
            throw new InvalidURI(`Missing password part: ${methodAndPassword}`);
        }
        const methodString = methodAndPassword.substring(0, methodEndIndex);
        const method = new Method(methodString);
        const passwordStartIndex = methodEndIndex + 1;
        const passwordString = methodAndPassword.substring(passwordStartIndex);
        const password = new Password(passwordString);
        const hostStartIndex = atSignIndex + 1;
        const hostAndPort = b64DecodedData.substring(hostStartIndex);
        const hostEndIndex = hostAndPort.indexOf(':');
        if (hostEndIndex === -1) {
            throw new InvalidURI(`Missing port part: ${hostAndPort}`);
        }
        const host = new Host(hostAndPort.substring(0, hostEndIndex));
        const portStartIndex = hostEndIndex + 1;
        const portString = hostAndPort.substring(portStartIndex);
        const port = new Port(portString);
        return new LegacyBase64URI({ method, password, host, port, tag });
    }
    toString() {
        const { b64EncodedData, tag } = this;
        const hash = ShadowsocksURI.getHash(this);
        return `ss://${b64EncodedData}${hash}`;
    }
}
platformExportObj.LegacyBase64URI = LegacyBase64URI;
class Sip002URI extends ShadowsocksURI {
    constructor(config) {
        super(new Config(config));
        const { method, password } = this;
        this.b64EncodedUserInfo = b64Encode(`${method}:${password}`);
        this.plugin = config.plugin;
    }
    set plugin(plugin) {
        this.plugin_ = new Plugin(plugin);
    }
    get plugin() {
        return this.plugin_.toString();
    }
    static parse(uri) {
        ShadowsocksURI.validateProtocol(uri);
        const inputForUrlParser = `http${uri.substring(2)}`;
        const urlParserResult = new URL(inputForUrlParser);
        const host = new Host(urlParserResult.hostname);
        const port = new Port(urlParserResult.port);
        const tag = new Tag(decodeURIComponent(urlParserResult.hash.substring(1)));
        const b64EncodedUserInfo = urlParserResult.username.replace(/%3D/g, '=');
        const b64DecodedUserInfo = b64Decode(b64EncodedUserInfo);
        const colonIdx = b64DecodedUserInfo.indexOf(':');
        if (colonIdx === -1) {
            throw new InvalidURI(`Missing password part: ${b64DecodedUserInfo}`);
        }
        const methodString = b64DecodedUserInfo.substring(0, colonIdx);
        const method = new Method(methodString);
        const passwordString = b64DecodedUserInfo.substring(colonIdx + 1);
        const password = new Password(passwordString);
        let plugin;
        if (urlParserResult.searchParams) {
            const pluginString = urlParserResult.searchParams.get('plugin');
            plugin = pluginString ? new Plugin(pluginString) : undefined;
        }
        return new Sip002URI({ method, password, host, port, tag, plugin });
    }
    toString() {
        const { b64EncodedUserInfo, host, port, plugin, tag } = this;
        const queryString = plugin ? `?plugin=${plugin}` : '';
        const hash = ShadowsocksURI.getHash(this);
        return `ss://${b64EncodedUserInfo}@${host}:${port}/${queryString}${hash}`;
    }
}
platformExportObj.Sip002URI = Sip002URI;
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLFdBQVcsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUN0RCxNQUFNLElBQUksR0FBRyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxRQUFRLGtCQUFrQixJQUFJLElBQUksSUFBSSxJQUFJLElBQUksV0FBVyxHQUFHLElBQUksRUFBRSxDQUFDO0lBQzVFLENBQUM7Q0FDRjtBQXJERCw4QkFxREMiLCJmaWxlIjoiU2hhZG93c29ja3NDb25maWcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSB0eXBlcz1cIm5vZGVcIiAvPlxuXG5jb25zdCBpc0Jyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJztcbmNvbnN0IGI2NEVuY29kZSA9IGlzQnJvd3NlciA/IGJ0b2EgOiByZXF1aXJlKCdiYXNlLTY0JykuZW5jb2RlO1xuY29uc3QgYjY0RGVjb2RlID0gaXNCcm93c2VyID8gYXRvYiA6IHJlcXVpcmUoJ2Jhc2UtNjQnKS5kZWNvZGU7XG5jb25zdCBVUkwgPSBpc0Jyb3dzZXIgPyB3aW5kb3cuVVJMIDogcmVxdWlyZSgndXJsJykuVVJMO1xuXG4vLyBDdXN0b20gZXJyb3IgYmFzZSBjbGFzc1xuZXhwb3J0IGNsYXNzIFNoYWRvd3NvY2tzQ29uZmlnRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHN1cGVyKG1lc3NhZ2UpOyAgLy8gJ0Vycm9yJyBicmVha3MgcHJvdG90eXBlIGNoYWluIGhlcmUgaWYgdGhpcyBpcyB0cmFuc3BpbGVkIHRvIGVzNVxuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7ICAvLyByZXN0b3JlIHByb3RvdHlwZSBjaGFpblxuICAgIHRoaXMubmFtZSA9IG5ldy50YXJnZXQubmFtZTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSW52YWxpZENvbmZpZ0ZpZWxkIGV4dGVuZHMgU2hhZG93c29ja3NDb25maWdFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyByZWFkb25seSBtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSW52YWxpZFVSSSBleHRlbmRzIFNoYWRvd3NvY2tzQ29uZmlnRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgcmVhZG9ubHkgbWVzc2FnZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gIH1cbn1cbi8vIEVuZCBjdXN0b20gZXJyb3JzXG5cbi8vIFNlbGYtdmFsaWRhdGluZy9ub3JtYWxpemluZyBjb25maWcgZGF0YSB0eXBlcyBzdWJjbGFzcyB0aGlzIENvbmZpZ0ZpZWxkIGNsYXNzLlxuLy8gQ29uc3RydWN0b3JzIHRha2UgYSBzdHJpbmcsIHZhbGlkYXRlL25vcm1hbGl6ZS9hY2NlcHQgaWYgdmFsaWQsIG9yIHRocm93IG90aGVyd2lzZS5cbi8vIFNvbWUgZXhhbXBsZXMgKFBvcnQgaXMgYSBDb25maWdGaWVsZCBzdWJjbGFzcywgc2VlIGJlbG93KTpcbi8vICAgbmV3IFBvcnQoJycpICAgICAgICAgICAtPiB0aHJvd3Ncbi8vICAgbmV3IFBvcnQoJ25vdCBhIHBvcnQnKSAtPiB0aHJvd3Ncbi8vICAgbmV3IFBvcnQoJy0xMjMnKSAgICAgICAtPiB0aHJvd3Ncbi8vICAgbmV3IFBvcnQoJzEyMy40JykgICAgICAtPiB0aHJvd3Ncbi8vICAgbmV3IFBvcnQoJzAxMjM0JykgICAgICAtPiAnMTIzNCdcbmV4cG9ydCBjbGFzcyBDb25maWdGaWVsZCB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyByZWFkb25seSBkYXRhOiBzdHJpbmcpIHt9XG5cbiAgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS50b1N0cmluZygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRocm93RXJyb3JGb3JJbnZhbGlkRmllbGQobmFtZTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gIHRocm93IG5ldyBJbnZhbGlkQ29uZmlnRmllbGQoYEludmFsaWQgJHtuYW1lfTogJHt2YWx1ZX1gKTtcbn1cblxuZXhwb3J0IGNsYXNzIEhvc3QgZXh0ZW5kcyBDb25maWdGaWVsZCB7XG4gIGNvbnN0cnVjdG9yKGhvc3Q6IEhvc3QgfCBzdHJpbmcpIHtcbiAgICBpZiAoaG9zdCBpbnN0YW5jZW9mIEhvc3QpIHtcbiAgICAgIGhvc3QgPSBob3N0LmRhdGE7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAvLyBUT0RPOiB1c2UgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaXAtYWRkcmVzcyB0byByZXN0cmljdCB0byBvbmx5IElQIGFkZHJlc3Nlc1xuICAgICAgY29uc3QgdXJsUGFyc2VyUmVzdWx0ID0gbmV3IFVSTChgaHR0cDovLyR7aG9zdH0vYCk7XG4gICAgICBzdXBlcih1cmxQYXJzZXJSZXN1bHQuaG9zdG5hbWUpO1xuICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgIHRocm93RXJyb3JGb3JJbnZhbGlkRmllbGQoJ2hvc3QnLCBob3N0KTtcbiAgICB9XG4gIH1cbn1cblxuLy8gUG9ydCB2YWxpZGF0aW9uL25vcm1hbGl6YXRpb24gaXMgYnVpbHQgb24gdG9wIG9mIFVSTCBmb3Igc2FmZXR5IGFuZCBlZmZpY2llbmN5LlxuLy8gTk9URTogUG9ydCBkYXRhIGlzIHN0b3JlZCBhcyBhIHN0cmluZywgbm90IGEgbnVtYmVyLCBhcyBpbiBhIFVSTCBpbnN0YW5jZS5cbmV4cG9ydCBjbGFzcyBQb3J0IGV4dGVuZHMgQ29uZmlnRmllbGQge1xuICBjb25zdHJ1Y3Rvcihwb3J0OiBQb3J0IHwgc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgaWYgKHBvcnQgaW5zdGFuY2VvZiBQb3J0KSB7XG4gICAgICBwb3J0ID0gcG9ydC5kYXRhO1xuICAgIH1cbiAgICBjb25zdCB0aHJvd0Vycm9yID0gKCkgPT4gdGhyb3dFcnJvckZvckludmFsaWRGaWVsZCgncG9ydCcsIHBvcnQpO1xuICAgIGlmIChwb3J0ID09PSAnJykgdGhyb3dFcnJvcigpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1cmxQYXJzZXJSZXN1bHQgPSBuZXcgVVJMKGBodHRwOi8vMC4wLjAuMDoke3BvcnR9L2ApO1xuICAgICAgc3VwZXIodXJsUGFyc2VyUmVzdWx0LnBvcnQpO1xuICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgIHRocm93RXJyb3IoKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gQSBtZXRob2QgdmFsdWUgbXVzdCBleGFjdGx5IG1hdGNoIGFuIGVsZW1lbnQgaW4gdGhlIHNldCBvZiBrbm93biBjaXBoZXJzLlxuLy8gcmVmOiBodHRwczovL2dpdGh1Yi5jb20vc2hhZG93c29ja3Mvc2hhZG93c29ja3MtbGliZXYvYmxvYi8xMGEyZDNlMy9jb21wbGV0aW9ucy9iYXNoL3NzLXJlZGlyI0w1XG5leHBvcnQgY2xhc3MgTWV0aG9kIGV4dGVuZHMgQ29uZmlnRmllbGQge1xuICBwcml2YXRlIHN0YXRpYyBNRVRIT0RTID0gbmV3IFNldChbXG4gICAgJ3JjNC1tZDUnLFxuICAgICdhZXMtMTI4LWdjbScsXG4gICAgJ2Flcy0xOTItZ2NtJyxcbiAgICAnYWVzLTI1Ni1nY20nLFxuICAgICdhZXMtMTI4LWNmYicsXG4gICAgJ2Flcy0xOTItY2ZiJyxcbiAgICAnYWVzLTI1Ni1jZmInLFxuICAgICdhZXMtMTI4LWN0cicsXG4gICAgJ2Flcy0xOTItY3RyJyxcbiAgICAnYWVzLTI1Ni1jdHInLFxuICAgICdjYW1lbGxpYS0xMjgtY2ZiJyxcbiAgICAnY2FtZWxsaWEtMTkyLWNmYicsXG4gICAgJ2NhbWVsbGlhLTI1Ni1jZmInLFxuICAgICdiZi1jZmInLFxuICAgICdjaGFjaGEyMC1pZXRmLXBvbHkxMzA1JyxcbiAgICAnc2Fsc2EyMCcsXG4gICAgJ2NoYWNoYTIwJyxcbiAgICAnY2hhY2hhMjAtaWV0ZicsXG4gICBdKTtcblxuICBjb25zdHJ1Y3RvcihtZXRob2Q6IE1ldGhvZCB8IHN0cmluZykge1xuICAgIGlmIChtZXRob2QgaW5zdGFuY2VvZiBNZXRob2QpIHtcbiAgICAgIG1ldGhvZCA9IG1ldGhvZC5kYXRhO1xuICAgIH1cbiAgICBzdXBlcihtZXRob2QpO1xuICAgIGlmICghTWV0aG9kLk1FVEhPRFMuaGFzKG1ldGhvZCkpIHtcbiAgICAgIHRocm93RXJyb3JGb3JJbnZhbGlkRmllbGQoJ21ldGhvZCcsIG1ldGhvZCk7XG4gICAgfVxuICB9XG59XG5cbi8vIEN1cnJlbnRseSBubyB2YWxpZGF0aW9uIGlzIHBlcmZvcm1lZCBmb3IgUGFzc3dvcmQsIFRhZywgb3IgUGx1Z2luLlxuLy8gQ2xpZW50IGNvZGUgaXMgcmVzcG9uc2libGUgZm9yIHZhbGlkYXRpbmcgYW5kIHNhbml0aXppbmcgdGhlc2Ugd2hlbiB1c2luZyB3aXRoIHVudHJ1c3RlZCBpbnB1dC5cbi8vIFRPRE86IERvY3VtZW50IHRoaXMgaW4gdGhlIFJFQURNRS5cbmV4cG9ydCBjbGFzcyBQYXNzd29yZCBleHRlbmRzIENvbmZpZ0ZpZWxkIHtcbiAgY29uc3RydWN0b3IocGFzc3dvcmQ/OiBQYXNzd29yZCB8IHN0cmluZykge1xuICAgIHN1cGVyKChwYXNzd29yZCBpbnN0YW5jZW9mIFBhc3N3b3JkID8gcGFzc3dvcmQuZGF0YSA6IHBhc3N3b3JkKSB8fCAnJyk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRhZyBleHRlbmRzIENvbmZpZ0ZpZWxkIHtcbiAgY29uc3RydWN0b3IodGFnPzogVGFnIHwgc3RyaW5nKSB7XG4gICAgc3VwZXIoKHRhZyBpbnN0YW5jZW9mIFRhZyA/IHRhZy5kYXRhIDogdGFnKSB8fCAnJyk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFBsdWdpbiBleHRlbmRzIENvbmZpZ0ZpZWxkIHtcbiAgY29uc3RydWN0b3IocGx1Z2luPzogUGx1Z2luIHwgc3RyaW5nKSB7XG4gICAgc3VwZXIoKHBsdWdpbiBpbnN0YW5jZW9mIFBsdWdpbiA/IHBsdWdpbi5kYXRhIDogcGx1Z2luKSB8fCAnJyk7XG4gIH1cbn1cbi8vIEVuZCBDb25maWdGaWVsZCB0eXBlcy5cblxuZXhwb3J0IGludGVyZmFjZSBVbnNhZmVDb25maWcge1xuICBob3N0PzogSG9zdCB8IHN0cmluZztcbiAgcG9ydD86IFBvcnQgfCBzdHJpbmcgfCBudW1iZXI7XG4gIG1ldGhvZD86IE1ldGhvZCB8IHN0cmluZztcbiAgcGFzc3dvcmQ/OiBQYXNzd29yZCB8IHN0cmluZztcbiAgdGFnPzogVGFnIHwgc3RyaW5nO1xuICBwbHVnaW4/OiBQbHVnaW4gfCBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maWcgaW1wbGVtZW50cyBVbnNhZmVDb25maWcge1xuICBwcml2YXRlIGhvc3RfOiBIb3N0O1xuICBwcml2YXRlIHBvcnRfOiBQb3J0O1xuICBwcml2YXRlIG1ldGhvZF86IE1ldGhvZDtcbiAgcHJpdmF0ZSBwYXNzd29yZF86IFBhc3N3b3JkO1xuICBwcml2YXRlIHRhZ186IFRhZztcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFVuc2FmZUNvbmZpZykge1xuICAgIHRoaXMuaG9zdCA9IGNvbmZpZy5ob3N0O1xuICAgIHRoaXMucG9ydCA9IGNvbmZpZy5wb3J0O1xuICAgIHRoaXMubWV0aG9kID0gY29uZmlnLm1ldGhvZDtcbiAgICB0aGlzLnBhc3N3b3JkID0gY29uZmlnLnBhc3N3b3JkO1xuICAgIHRoaXMudGFnID0gY29uZmlnLnRhZztcbiAgfVxuXG4gIHNldCBob3N0KGhvc3Q6IEhvc3QgfCBzdHJpbmcpIHtcbiAgICB0aGlzLmhvc3RfID0gbmV3IEhvc3QoaG9zdCk7XG4gIH1cblxuICBzZXQgcG9ydChwb3J0OiBQb3J0IHwgc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgdGhpcy5wb3J0XyA9IG5ldyBQb3J0KHBvcnQpO1xuICB9XG5cbiAgc2V0IG1ldGhvZChtZXRob2Q6IE1ldGhvZCB8IHN0cmluZykge1xuICAgIHRoaXMubWV0aG9kXyA9IG5ldyBNZXRob2QobWV0aG9kKTtcbiAgfVxuXG4gIHNldCBwYXNzd29yZChwYXNzd29yZDogUGFzc3dvcmQgfCBzdHJpbmcpIHtcbiAgICB0aGlzLnBhc3N3b3JkXyA9IG5ldyBQYXNzd29yZChwYXNzd29yZCk7XG4gIH1cblxuICBzZXQgdGFnKHRhZzogVGFnIHwgc3RyaW5nKSB7XG4gICAgdGhpcy50YWdfID0gbmV3IFRhZyh0YWcpO1xuICB9XG5cbiAgZ2V0IGhvc3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuaG9zdF8udG9TdHJpbmcoKTtcbiAgfVxuXG4gIGdldCBwb3J0KCkge1xuICAgIHJldHVybiB0aGlzLnBvcnRfLnRvU3RyaW5nKCk7XG4gIH1cblxuICBnZXQgbWV0aG9kKCkge1xuICAgIHJldHVybiB0aGlzLm1ldGhvZF8udG9TdHJpbmcoKTtcbiAgfVxuXG4gIGdldCBwYXNzd29yZCgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXNzd29yZF8udG9TdHJpbmcoKTtcbiAgfVxuXG4gIGdldCB0YWcoKSB7XG4gICAgcmV0dXJuIHRoaXMudGFnXy50b1N0cmluZygpO1xuICB9XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBTaGFkb3dzb2Nrc1VSSSBleHRlbmRzIENvbmZpZyB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogVW5zYWZlQ29uZmlnKSB7XG4gICAgc3VwZXIobmV3IENvbmZpZyhjb25maWcpKTtcbiAgfVxuXG4gIGFic3RyYWN0IHRvU3RyaW5nKCk6IHN0cmluZztcblxuICBzdGF0aWMgdmFsaWRhdGVQcm90b2NvbCh1cmk6IHN0cmluZykge1xuICAgIGlmICghdXJpLnN0YXJ0c1dpdGgoJ3NzOi8vJykpIHtcbiAgICAgIHRocm93IG5ldyBJbnZhbGlkVVJJKGBVUkkgbXVzdCBzdGFydCB3aXRoIFwic3M6Ly9cIjogJHt1cml9YCk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGdldEhhc2goY29uZmlnOiBVbnNhZmVDb25maWcpIHtcbiAgICBjb25zdCB0YWcgPSBjb25maWcudGFnIGluc3RhbmNlb2YgVGFnID8gY29uZmlnLnRhZy5kYXRhIDogY29uZmlnLnRhZztcbiAgICByZXR1cm4gdGFnID8gYCMke2VuY29kZVVSSUNvbXBvbmVudCh0YWcpfWAgOiAnJztcbiAgfVxuXG4gIHN0YXRpYyBwYXJzZSh1cmk6IHN0cmluZyk6IFVuc2FmZUNvbmZpZyB7XG4gICAgbGV0IGVycm9yOiBFcnJvcjtcbiAgICBmb3IgKGNvbnN0IFVyaVR5cGUgb2YgW0xlZ2FjeUJhc2U2NFVSSSwgU2lwMDAyVVJJXSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIFVyaVR5cGUucGFyc2UodXJpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgZXJyb3IgPSBlcnJvciB8fCBlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIShlcnJvciBpbnN0YW5jZW9mIEludmFsaWRVUkkpKSB7XG4gICAgICBjb25zdCBvcmlnaW5hbEVycm9yTmFtZSA9IChlcnJvciBhcyBFcnJvcikubmFtZSB8fCAnKFVubmFtZWQgRXJyb3IpJztcbiAgICAgIGNvbnN0IG9yaWdpbmFsRXJyb3JNZXNzYWdlID0gKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlIHx8ICcobm8gZXJyb3IgbWVzc2FnZSBwcm92aWRlZCknO1xuICAgICAgY29uc3Qgb3JpZ2luYWxFcnJvclN0cmluZyA9IGAke29yaWdpbmFsRXJyb3JOYW1lfTogJHtvcmlnaW5hbEVycm9yTWVzc2FnZX1gO1xuICAgICAgY29uc3QgbmV3RXJyb3JNZXNzYWdlID0gYEludmFsaWQgaW5wdXQ6ICR7dXJpfSAtIE9yaWdpbmFsIGVycm9yOiAke29yaWdpbmFsRXJyb3JTdHJpbmd9YDtcbiAgICAgIGVycm9yID0gbmV3IEludmFsaWRVUkkobmV3RXJyb3JNZXNzYWdlKTtcbiAgICB9XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLy8gUmVmOiBodHRwczovL3NoYWRvd3NvY2tzLm9yZy9lbi9jb25maWcvcXVpY2stZ3VpZGUuaHRtbFxuZXhwb3J0IGNsYXNzIExlZ2FjeUJhc2U2NFVSSSBleHRlbmRzIFNoYWRvd3NvY2tzVVJJIHtcbiAgYjY0RW5jb2RlZERhdGE6IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFVuc2FmZUNvbmZpZykge1xuICAgIHN1cGVyKG5ldyBDb25maWcoY29uZmlnKSk7XG4gICAgY29uc3QgeyBtZXRob2QsIHBhc3N3b3JkLCBob3N0LCBwb3J0IH0gPSB0aGlzO1xuICAgIGNvbnN0IGI2NEVuY29kZWREYXRhID0gYjY0RW5jb2RlKGAke21ldGhvZH06JHtwYXNzd29yZH1AJHtob3N0fToke3BvcnR9YCk7XG4gICAgY29uc3QgZGF0YUxlbmd0aCA9IGI2NEVuY29kZWREYXRhLmxlbmd0aDtcbiAgICBsZXQgcGFkZGluZ0xlbmd0aCA9IDA7XG4gICAgZm9yICg7IGI2NEVuY29kZWREYXRhW2RhdGFMZW5ndGggLSAxIC0gcGFkZGluZ0xlbmd0aF0gPT09ICc9JzsgcGFkZGluZ0xlbmd0aCsrKTtcbiAgICB0aGlzLmI2NEVuY29kZWREYXRhID0gcGFkZGluZ0xlbmd0aCA9PT0gMCA/IGI2NEVuY29kZWREYXRhIDpcbiAgICAgICAgYjY0RW5jb2RlZERhdGEuc3Vic3RyaW5nKDAsIGRhdGFMZW5ndGggLSBwYWRkaW5nTGVuZ3RoKTtcbiAgfVxuXG4gIHN0YXRpYyBwYXJzZSh1cmk6IHN0cmluZykge1xuICAgIFNoYWRvd3NvY2tzVVJJLnZhbGlkYXRlUHJvdG9jb2wodXJpKTtcbiAgICBjb25zdCBoYXNoSW5kZXggPSB1cmkuaW5kZXhPZignIycpO1xuICAgIGxldCBiNjRFbmRJbmRleCA9IGhhc2hJbmRleDtcbiAgICBsZXQgdGFnU3RhcnRJbmRleCA9IGhhc2hJbmRleCArIDE7XG4gICAgaWYgKGhhc2hJbmRleCA9PT0gLTEpIHtcbiAgICAgIGI2NEVuZEluZGV4ID0gdGFnU3RhcnRJbmRleCA9IHVyaS5sZW5ndGg7XG4gICAgfVxuICAgIGNvbnN0IHRhZyA9IG5ldyBUYWcoZGVjb2RlVVJJQ29tcG9uZW50KHVyaS5zdWJzdHJpbmcodGFnU3RhcnRJbmRleCkpKTtcbiAgICBjb25zdCBiNjRFbmNvZGVkRGF0YSA9IHVyaS5zdWJzdHJpbmcoJ3NzOi8vJy5sZW5ndGgsIGI2NEVuZEluZGV4KTtcbiAgICBjb25zdCBiNjREZWNvZGVkRGF0YSA9IGI2NERlY29kZShiNjRFbmNvZGVkRGF0YSk7XG4gICAgY29uc3QgYXRTaWduSW5kZXggPSBiNjREZWNvZGVkRGF0YS5pbmRleE9mKCdAJyk7XG4gICAgaWYgKGF0U2lnbkluZGV4ID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVUkkoYE1pc3NpbmcgXCJAXCI6ICR7YjY0RGVjb2RlZERhdGF9YCk7XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZEFuZFBhc3N3b3JkID0gYjY0RGVjb2RlZERhdGEuc3Vic3RyaW5nKDAsIGF0U2lnbkluZGV4KTtcbiAgICBjb25zdCBtZXRob2RFbmRJbmRleCA9IG1ldGhvZEFuZFBhc3N3b3JkLmluZGV4T2YoJzonKTtcbiAgICBpZiAobWV0aG9kRW5kSW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVSSShgTWlzc2luZyBwYXNzd29yZCBwYXJ0OiAke21ldGhvZEFuZFBhc3N3b3JkfWApO1xuICAgIH1cbiAgICBjb25zdCBtZXRob2RTdHJpbmcgPSBtZXRob2RBbmRQYXNzd29yZC5zdWJzdHJpbmcoMCwgbWV0aG9kRW5kSW5kZXgpO1xuICAgIGNvbnN0IG1ldGhvZCA9IG5ldyBNZXRob2QobWV0aG9kU3RyaW5nKTtcbiAgICBjb25zdCBwYXNzd29yZFN0YXJ0SW5kZXggPSBtZXRob2RFbmRJbmRleCArIDE7XG4gICAgY29uc3QgcGFzc3dvcmRTdHJpbmcgPSBtZXRob2RBbmRQYXNzd29yZC5zdWJzdHJpbmcocGFzc3dvcmRTdGFydEluZGV4KTtcbiAgICBjb25zdCBwYXNzd29yZCA9IG5ldyBQYXNzd29yZChwYXNzd29yZFN0cmluZyk7XG4gICAgY29uc3QgaG9zdFN0YXJ0SW5kZXggPSBhdFNpZ25JbmRleCArIDE7XG4gICAgY29uc3QgaG9zdEFuZFBvcnQgPSBiNjREZWNvZGVkRGF0YS5zdWJzdHJpbmcoaG9zdFN0YXJ0SW5kZXgpO1xuICAgIGNvbnN0IGhvc3RFbmRJbmRleCA9IGhvc3RBbmRQb3J0LmluZGV4T2YoJzonKTtcbiAgICBpZiAoaG9zdEVuZEluZGV4ID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVUkkoYE1pc3NpbmcgcG9ydCBwYXJ0OiAke2hvc3RBbmRQb3J0fWApO1xuICAgIH1cbiAgICBjb25zdCBob3N0ID0gbmV3IEhvc3QoaG9zdEFuZFBvcnQuc3Vic3RyaW5nKDAsIGhvc3RFbmRJbmRleCkpO1xuICAgIGNvbnN0IHBvcnRTdGFydEluZGV4ID0gaG9zdEVuZEluZGV4ICsgMTtcbiAgICBjb25zdCBwb3J0U3RyaW5nID0gaG9zdEFuZFBvcnQuc3Vic3RyaW5nKHBvcnRTdGFydEluZGV4KTtcbiAgICBjb25zdCBwb3J0ID0gbmV3IFBvcnQocG9ydFN0cmluZyk7XG4gICAgcmV0dXJuIG5ldyBMZWdhY3lCYXNlNjRVUkkoeyBtZXRob2QsIHBhc3N3b3JkLCBob3N0LCBwb3J0LCB0YWcgfSk7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICBjb25zdCB7IGI2NEVuY29kZWREYXRhLCB0YWcgfSA9IHRoaXM7XG4gICAgY29uc3QgaGFzaCA9IFNoYWRvd3NvY2tzVVJJLmdldEhhc2godGhpcyk7XG4gICAgcmV0dXJuIGBzczovLyR7YjY0RW5jb2RlZERhdGF9JHtoYXNofWA7XG4gIH1cbn1cblxuLy8gUmVmOiBodHRwczovL3NoYWRvd3NvY2tzLm9yZy9lbi9zcGVjL1NJUDAwMi1VUkktU2NoZW1lLmh0bWxcbi8vIE5PVEU6IEN1cnJlbnRseSB0aGUgcGx1Z2luIHF1ZXJ5IHBhcmFtIGlzIHByZXNlcnZlZCBvbiBhIGJlc3QtZWZmb3J0IGJhc2lzLiBJdCBpcyBzaWxlbnRseVxuLy8gICAgICAgZHJvcHBlZCBvbiBwbGF0Zm9ybXMgdGhhdCBkbyBub3Qgc3VwcG9ydCB0aGUgZnVsbCB3aGF0d2cgVVJMIHN0YW5kYXJkIChjZi4gYHNlYXJjaFBhcmFtc2ApLlxuLy8gICAgICAgUmVmOlxuLy8gICAgICAgICAtIGh0dHBzOi8vdXJsLnNwZWMud2hhdHdnLm9yZy8jdXJsLWNsYXNzXG4vLyAgICAgICAgIC0gaHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD11cmxzZWFyY2hwYXJhbXNcbmV4cG9ydCBjbGFzcyBTaXAwMDJVUkkgZXh0ZW5kcyBTaGFkb3dzb2Nrc1VSSSB7XG4gIGI2NEVuY29kZWRVc2VySW5mbzogc3RyaW5nO1xuICBwcml2YXRlIHBsdWdpbl86IFBsdWdpbjtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFVuc2FmZUNvbmZpZykge1xuICAgIHN1cGVyKG5ldyBDb25maWcoY29uZmlnKSk7XG4gICAgY29uc3QgeyBtZXRob2QsIHBhc3N3b3JkIH0gPSB0aGlzO1xuICAgIHRoaXMuYjY0RW5jb2RlZFVzZXJJbmZvID0gYjY0RW5jb2RlKGAke21ldGhvZH06JHtwYXNzd29yZH1gKTtcbiAgICB0aGlzLnBsdWdpbiA9IChjb25maWcgYXMgU2lwMDAyVVJJKS5wbHVnaW47XG4gIH1cblxuICBzZXQgcGx1Z2luKHBsdWdpbjogUGx1Z2luIHwgc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5wbHVnaW5fID0gbmV3IFBsdWdpbihwbHVnaW4pO1xuICB9XG5cbiAgZ2V0IHBsdWdpbigpIHtcbiAgICByZXR1cm4gdGhpcy5wbHVnaW5fLnRvU3RyaW5nKCk7XG4gIH1cblxuICBzdGF0aWMgcGFyc2UodXJpOiBzdHJpbmcpIHtcbiAgICBTaGFkb3dzb2Nrc1VSSS52YWxpZGF0ZVByb3RvY29sKHVyaSk7XG4gICAgLy8gcmVwbGFjZSBcInNzXCIgd2l0aCBcImh0dHBcIiBzbyBVUkwgYnVpbHQtaW4gcGFyc2VyIHBhcnNlcyBpdCBjb3JyZWN0bHkuXG4gICAgY29uc3QgaW5wdXRGb3JVcmxQYXJzZXIgPSBgaHR0cCR7dXJpLnN1YnN0cmluZygyKX1gO1xuICAgIC8vIFRoZSBidWlsdC1pbiBVUkwgcGFyc2VyIHRocm93cyBhcyBkZXNpcmVkIHdoZW4gZ2l2ZW4gVVJJcyB3aXRoIGludmFsaWQgc3ludGF4LlxuICAgIGNvbnN0IHVybFBhcnNlclJlc3VsdCA9IG5ldyBVUkwoaW5wdXRGb3JVcmxQYXJzZXIpO1xuICAgIGNvbnN0IGhvc3QgPSBuZXcgSG9zdCh1cmxQYXJzZXJSZXN1bHQuaG9zdG5hbWUpO1xuICAgIGNvbnN0IHBvcnQgPSBuZXcgUG9ydCh1cmxQYXJzZXJSZXN1bHQucG9ydCk7XG4gICAgY29uc3QgdGFnID0gbmV3IFRhZyhkZWNvZGVVUklDb21wb25lbnQodXJsUGFyc2VyUmVzdWx0Lmhhc2guc3Vic3RyaW5nKDEpKSk7XG4gICAgY29uc3QgYjY0RW5jb2RlZFVzZXJJbmZvID0gdXJsUGFyc2VyUmVzdWx0LnVzZXJuYW1lLnJlcGxhY2UoLyUzRC9nLCAnPScpO1xuICAgIC8vIGJhc2U2NC5kZWNvZGUgdGhyb3dzIGFzIGRlc2lyZWQgd2hlbiBnaXZlbiBpbnZhbGlkIGJhc2U2NCBpbnB1dC5cbiAgICBjb25zdCBiNjREZWNvZGVkVXNlckluZm8gPSBiNjREZWNvZGUoYjY0RW5jb2RlZFVzZXJJbmZvKTtcbiAgICBjb25zdCBjb2xvbklkeCA9IGI2NERlY29kZWRVc2VySW5mby5pbmRleE9mKCc6Jyk7XG4gICAgaWYgKGNvbG9uSWR4ID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVUkkoYE1pc3NpbmcgcGFzc3dvcmQgcGFydDogJHtiNjREZWNvZGVkVXNlckluZm99YCk7XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZFN0cmluZyA9IGI2NERlY29kZWRVc2VySW5mby5zdWJzdHJpbmcoMCwgY29sb25JZHgpO1xuICAgIGNvbnN0IG1ldGhvZCA9IG5ldyBNZXRob2QobWV0aG9kU3RyaW5nKTtcbiAgICBjb25zdCBwYXNzd29yZFN0cmluZyA9IGI2NERlY29kZWRVc2VySW5mby5zdWJzdHJpbmcoY29sb25JZHggKyAxKTtcbiAgICBjb25zdCBwYXNzd29yZCA9IG5ldyBQYXNzd29yZChwYXNzd29yZFN0cmluZyk7XG4gICAgbGV0IHBsdWdpbjogUGx1Z2luO1xuICAgIGlmICh1cmxQYXJzZXJSZXN1bHQuc2VhcmNoUGFyYW1zKSB7XG4gICAgICBjb25zdCBwbHVnaW5TdHJpbmcgPSB1cmxQYXJzZXJSZXN1bHQuc2VhcmNoUGFyYW1zLmdldCgncGx1Z2luJyk7XG4gICAgICBwbHVnaW4gPSBwbHVnaW5TdHJpbmcgPyBuZXcgUGx1Z2luKHBsdWdpblN0cmluZykgOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJldHVybiBuZXcgU2lwMDAyVVJJKHsgbWV0aG9kLCBwYXNzd29yZCwgaG9zdCwgcG9ydCwgdGFnLCBwbHVnaW4gfSBhcyBTaXAwMDJVUkkpO1xuICB9XG5cbiAgdG9TdHJpbmcoKSB7XG4gICAgY29uc3QgeyBiNjRFbmNvZGVkVXNlckluZm8sIGhvc3QsIHBvcnQsIHBsdWdpbiwgdGFnIH0gPSB0aGlzO1xuICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gcGx1Z2luID8gYD9wbHVnaW49JHtwbHVnaW59YCA6ICcnO1xuICAgIGNvbnN0IGhhc2ggPSBTaGFkb3dzb2Nrc1VSSS5nZXRIYXNoKHRoaXMpO1xuICAgIHJldHVybiBgc3M6Ly8ke2I2NEVuY29kZWRVc2VySW5mb31AJHtob3N0fToke3BvcnR9LyR7cXVlcnlTdHJpbmd9JHtoYXNofWA7XG4gIH1cbn1cbiJdfQ==
