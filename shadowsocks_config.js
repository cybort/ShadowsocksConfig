"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
(function iife() {
  const platformExportObj = (function detectPlatformExportObj() {
    if (typeof module !== 'undefined' && module.exports) {
      return module.exports;  // node
    } else if (typeof window !== 'undefined') {
      return window;  // browser
    }
    throw new Error('Could not detect platform global object (no window or module.exports)');
  })();
var isBrowser = typeof window !== 'undefined';
var b64Encode = isBrowser ? btoa : require('base-64').encode;
var b64Decode = isBrowser ? atob : require('base-64').decode;
var URL = isBrowser ? window.URL : require('url').URL;
var punycode = isBrowser ? window.punycode : require('punycode');
if (!punycode) {
    throw new Error("Could not find punycode. Did you forget to add e.g.\n  <script src=\"bower_components/punycode/punycode.min.js\"></script>?");
}
var ShadowsocksConfigError = (function (_super) {
    __extends(ShadowsocksConfigError, _super);
    function ShadowsocksConfigError(message) {
        var _newTarget = this.constructor;
        var _this = _super.call(this, message) || this;
        Object.setPrototypeOf(_this, _newTarget.prototype);
        _this.name = _newTarget.name;
        return _this;
    }
    return ShadowsocksConfigError;
}(Error));
platformExportObj.ShadowsocksConfigError = ShadowsocksConfigError;
var InvalidConfigField = (function (_super) {
    __extends(InvalidConfigField, _super);
    function InvalidConfigField() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return InvalidConfigField;
}(ShadowsocksConfigError));
platformExportObj.InvalidConfigField = InvalidConfigField;
var InvalidUri = (function (_super) {
    __extends(InvalidUri, _super);
    function InvalidUri() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return InvalidUri;
}(ShadowsocksConfigError));
platformExportObj.InvalidUri = InvalidUri;
var ValidatedConfigField = (function () {
    function ValidatedConfigField() {
    }
    return ValidatedConfigField;
}());
platformExportObj.ValidatedConfigField = ValidatedConfigField;
function throwErrorForInvalidField(name, value, reason) {
    throw new InvalidConfigField("Invalid " + name + ": " + value + " " + (reason || ''));
}
var Host = (function (_super) {
    __extends(Host, _super);
    function Host(host) {
        var _this = _super.call(this) || this;
        if (!host) {
            throwErrorForInvalidField('host', host);
        }
        if (host instanceof Host) {
            host = host.data;
        }
        host = punycode.toASCII(host);
        _this.isIPv4 = Host.IPV4_PATTERN.test(host);
        _this.isIPv6 = _this.isIPv4 ? false : Host.IPV6_PATTERN.test(host);
        _this.isHostname = _this.isIPv4 || _this.isIPv6 ? false : Host.HOSTNAME_PATTERN.test(host);
        if (!(_this.isIPv4 || _this.isIPv6 || _this.isHostname)) {
            throwErrorForInvalidField('host', host);
        }
        _this.data = host;
        return _this;
    }
    Host.IPV4_PATTERN = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
    Host.IPV6_PATTERN = /^(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}$/i;
    Host.HOSTNAME_PATTERN = /^[A-z0-9]+[A-z0-9_.-]*$/;
    return Host;
}(ValidatedConfigField));
platformExportObj.Host = Host;
var Port = (function (_super) {
    __extends(Port, _super);
    function Port(port) {
        var _this = _super.call(this) || this;
        if (port instanceof Port) {
            port = port.data;
        }
        if (typeof port === 'number') {
            port = port.toString();
        }
        if (!Port.PATTERN.test(port)) {
            throwErrorForInvalidField('port', port);
        }
        port = Number(port);
        if (port > 65535) {
            throwErrorForInvalidField('port', port);
        }
        _this.data = port;
        return _this;
    }
    Port.PATTERN = /^[0-9]{1,5}$/;
    return Port;
}(ValidatedConfigField));
platformExportObj.Port = Port;
platformExportObj.METHODS = new Set([
    'rc4-md5',
    'aes-128-gcm',
    'aes-192-gcm',
    'aes-256-gcm',
    'aes-128-cfb',
    'aes-192-cfb',
    'aes-256-cfb',
    'aes-128-ctr',
    'aes-192-ctr',
    'aes-256-ctr',
    'camellia-128-cfb',
    'camellia-192-cfb',
    'camellia-256-cfb',
    'bf-cfb',
    'chacha20-ietf-poly1305',
    'salsa20',
    'chacha20',
    'chacha20-ietf',
]);
var Method = (function (_super) {
    __extends(Method, _super);
    function Method(method) {
        var _this = _super.call(this) || this;
        if (method instanceof Method) {
            method = method.data;
        }
        if (!platformExportObj.METHODS.has(method)) {
            throwErrorForInvalidField('method', method);
        }
        _this.data = method;
        return _this;
    }
    return Method;
}(ValidatedConfigField));
platformExportObj.Method = Method;
var Password = (function (_super) {
    __extends(Password, _super);
    function Password(password) {
        var _this = _super.call(this) || this;
        _this.data = password instanceof Password ? password.data : password;
        return _this;
    }
    return Password;
}(ValidatedConfigField));
platformExportObj.Password = Password;
var Tag = (function (_super) {
    __extends(Tag, _super);
    function Tag(tag) {
        if (tag === void 0) { tag = ''; }
        var _this = _super.call(this) || this;
        _this.data = tag instanceof Tag ? tag.data : tag;
        return _this;
    }
    return Tag;
}(ValidatedConfigField));
platformExportObj.Tag = Tag;
function makeConfig(input) {
    var config = {
        host: new Host(input.host),
        port: new Port(input.port),
        method: new Method(input.method),
        password: new Password(input.password),
        tag: new Tag(input.tag),
        extra: {},
    };
    for (var _i = 0, _a = Object.keys(input); _i < _a.length; _i++) {
        var key = _a[_i];
        if (!/^(host|port|method|password|tag)$/.test(key)) {
            config.extra[key] = input[key] && input[key].toString();
        }
    }
    return config;
}
platformExportObj.makeConfig = makeConfig;
platformExportObj.SHADOWSOCKS_URI = {
    PROTOCOL: 'ss:',
    getUriFormattedHost: function (host) {
        return host.isIPv6 ? "[" + host.data + "]" : host.data;
    },
    getHash: function (tag) {
        return tag.data ? "#" + encodeURIComponent(tag.data) : '';
    },
    validateProtocol: function (uri) {
        if (!uri.startsWith(platformExportObj.SHADOWSOCKS_URI.PROTOCOL)) {
            throw new InvalidUri("URI must start with \"" + platformExportObj.SHADOWSOCKS_URI.PROTOCOL + "\": " + uri);
        }
    },
    parse: function (uri) {
        var error;
        for (var _i = 0, _a = [platformExportObj.SIP002_URI, platformExportObj.LEGACY_BASE64_URI]; _i < _a.length; _i++) {
            var uriType = _a[_i];
            try {
                return uriType.parse(uri);
            }
            catch (e) {
                error = e;
            }
        }
        if (!(error instanceof InvalidUri)) {
            var originalErrorName = error.name || '(Unnamed Error)';
            var originalErrorMessage = error.message || '(no error message provided)';
            var originalErrorString = originalErrorName + ": " + originalErrorMessage;
            var newErrorMessage = "Invalid input: " + uri + " - Original error: " + originalErrorString;
            error = new InvalidUri(newErrorMessage);
        }
        throw error;
    },
};
platformExportObj.LEGACY_BASE64_URI = {
    parse: function (uri) {
        platformExportObj.SHADOWSOCKS_URI.validateProtocol(uri);
        var hashIndex = uri.indexOf('#');
        var hasTag = hashIndex !== -1;
        var b64EndIndex = hasTag ? hashIndex : uri.length;
        var tagStartIndex = hasTag ? hashIndex + 1 : uri.length;
        var tag = new Tag(decodeURIComponent(uri.substring(tagStartIndex)));
        var b64EncodedData = uri.substring('ss://'.length, b64EndIndex);
        var b64DecodedData = b64Decode(b64EncodedData);
        var atSignIndex = b64DecodedData.indexOf('@');
        if (atSignIndex === -1) {
            throw new InvalidUri("Missing \"@\": " + b64DecodedData);
        }
        var methodAndPassword = b64DecodedData.substring(0, atSignIndex);
        var methodEndIndex = methodAndPassword.indexOf(':');
        if (methodEndIndex === -1) {
            throw new InvalidUri("Missing password part: " + methodAndPassword);
        }
        var methodString = methodAndPassword.substring(0, methodEndIndex);
        var method = new Method(methodString);
        var passwordStartIndex = methodEndIndex + 1;
        var passwordString = methodAndPassword.substring(passwordStartIndex);
        var password = new Password(passwordString);
        var hostStartIndex = atSignIndex + 1;
        var hostAndPort = b64DecodedData.substring(hostStartIndex);
        var hostEndIndex = hostAndPort.lastIndexOf(':');
        if (hostEndIndex === -1) {
            throw new InvalidUri("Missing port part: " + hostAndPort);
        }
        var uriFormattedHost = hostAndPort.substring(0, hostEndIndex);
        var host;
        try {
            host = new Host(uriFormattedHost);
        }
        catch (_) {
            host = new Host(uriFormattedHost.substring(1, uriFormattedHost.length - 1));
        }
        var portStartIndex = hostEndIndex + 1;
        var portString = hostAndPort.substring(portStartIndex);
        var port = new Port(portString);
        var extra = {};
        return { method: method, password: password, host: host, port: port, tag: tag, extra: extra };
    },
    stringify: function (config) {
        var host = config.host, port = config.port, method = config.method, password = config.password, tag = config.tag;
        var hash = platformExportObj.SHADOWSOCKS_URI.getHash(tag);
        var b64EncodedData = b64Encode(method.data + ":" + password.data + "@" + host.data + ":" + port.data);
        var dataLength = b64EncodedData.length;
        var paddingLength = 0;
        for (; b64EncodedData[dataLength - 1 - paddingLength] === '='; paddingLength++)
            ;
        b64EncodedData = paddingLength === 0 ? b64EncodedData :
            b64EncodedData.substring(0, dataLength - paddingLength);
        return "ss://" + b64EncodedData + hash;
    },
};
platformExportObj.SIP002_URI = {
    parse: function (uri) {
        platformExportObj.SHADOWSOCKS_URI.validateProtocol(uri);
        var inputForUrlParser = "http" + uri.substring(2);
        var urlParserResult = new URL(inputForUrlParser);
        var uriFormattedHost = urlParserResult.hostname;
        var last = uriFormattedHost.length - 1;
        var brackets = uriFormattedHost[0] === '[' && uriFormattedHost[last] === ']';
        var hostString = brackets ? uriFormattedHost.substring(1, last) : uriFormattedHost;
        var host = new Host(hostString);
        var port = new Port(urlParserResult.port);
        var tag = new Tag(decodeURIComponent(urlParserResult.hash.substring(1)));
        var b64EncodedUserInfo = urlParserResult.username.replace(/%3D/g, '=');
        var b64DecodedUserInfo = b64Decode(b64EncodedUserInfo);
        var colonIdx = b64DecodedUserInfo.indexOf(':');
        if (colonIdx === -1) {
            throw new InvalidUri("Missing password part: " + b64DecodedUserInfo);
        }
        var methodString = b64DecodedUserInfo.substring(0, colonIdx);
        var method = new Method(methodString);
        var passwordString = b64DecodedUserInfo.substring(colonIdx + 1);
        var password = new Password(passwordString);
        var queryParams = urlParserResult.search.substring(1).split('&');
        var extra = {};
        for (var _i = 0, queryParams_1 = queryParams; _i < queryParams_1.length; _i++) {
            var pair = queryParams_1[_i];
            var _a = pair.split('=', 2), key = _a[0], value = _a[1];
            if (!key)
                continue;
            extra[key] = decodeURIComponent(value || '');
        }
        return { method: method, password: password, host: host, port: port, tag: tag, extra: extra };
    },
    stringify: function (config) {
        var host = config.host, port = config.port, method = config.method, password = config.password, tag = config.tag, extra = config.extra;
        var userInfo = b64Encode(method.data + ":" + password.data);
        var uriHost = platformExportObj.SHADOWSOCKS_URI.getUriFormattedHost(host);
        var hash = platformExportObj.SHADOWSOCKS_URI.getHash(tag);
        var queryString = '';
        for (var key in extra) {
            if (!key)
                continue;
            queryString += (queryString ? '&' : '?') + (key + "=" + encodeURIComponent(extra[key]));
        }
        return "ss://" + userInfo + "@" + uriHost + ":" + port.data + "/" + queryString + hash;
    },
};
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,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QyxDQUFDLENBQUM7WUFDeEIsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7Z0JBQUMsUUFBUSxDQUFDO1lBQ25CLFdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBTSxHQUFHLFNBQUksa0JBQWtCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFHLENBQUEsQ0FBQztRQUN4RixDQUFDO1FBQ0QsTUFBTSxDQUFDLFVBQVEsUUFBUSxTQUFJLE9BQU8sU0FBSSxJQUFJLENBQUMsSUFBSSxTQUFJLFdBQVcsR0FBRyxJQUFNLENBQUM7SUFDMUUsQ0FBQztDQUNGLENBQUMiLCJmaWxlIjoic2hhZG93c29ja3NfY29uZmlnLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTcgVGhlIHVQcm94eSBBdXRob3JzXG4vL1xuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbi8vIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4vLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cblxuLyogdHNsaW50OmRpc2FibGUgKi9cbmNvbnN0IGlzQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnO1xuY29uc3QgYjY0RW5jb2RlID0gaXNCcm93c2VyID8gYnRvYSA6IHJlcXVpcmUoJ2Jhc2UtNjQnKS5lbmNvZGU7XG5jb25zdCBiNjREZWNvZGUgPSBpc0Jyb3dzZXIgPyBhdG9iIDogcmVxdWlyZSgnYmFzZS02NCcpLmRlY29kZTtcbmNvbnN0IFVSTCA9IGlzQnJvd3NlciA/IHdpbmRvdy5VUkwgOiByZXF1aXJlKCd1cmwnKS5VUkw7XG5jb25zdCBwdW55Y29kZSA9IGlzQnJvd3NlciA/ICh3aW5kb3cgYXMgYW55KS5wdW55Y29kZSA6IHJlcXVpcmUoJ3B1bnljb2RlJyk7XG5pZiAoIXB1bnljb2RlKSB7XG4gIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgcHVueWNvZGUuIERpZCB5b3UgZm9yZ2V0IHRvIGFkZCBlLmcuXG4gIDxzY3JpcHQgc3JjPVwiYm93ZXJfY29tcG9uZW50cy9wdW55Y29kZS9wdW55Y29kZS5taW4uanNcIj48L3NjcmlwdD4/YCk7XG59XG4vKiB0c2xpbnQ6ZW5hYmxlICovXG5cbi8vIEN1c3RvbSBlcnJvciBiYXNlIGNsYXNzXG5leHBvcnQgY2xhc3MgU2hhZG93c29ja3NDb25maWdFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7ICAvLyAnRXJyb3InIGJyZWFrcyBwcm90b3R5cGUgY2hhaW4gaGVyZSBpZiB0aGlzIGlzIHRyYW5zcGlsZWQgdG8gZXM1XG4gICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIG5ldy50YXJnZXQucHJvdG90eXBlKTsgIC8vIHJlc3RvcmUgcHJvdG90eXBlIGNoYWluXG4gICAgdGhpcy5uYW1lID0gbmV3LnRhcmdldC5uYW1lO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnZhbGlkQ29uZmlnRmllbGQgZXh0ZW5kcyBTaGFkb3dzb2Nrc0NvbmZpZ0Vycm9yIHt9XG5cbmV4cG9ydCBjbGFzcyBJbnZhbGlkVXJpIGV4dGVuZHMgU2hhZG93c29ja3NDb25maWdFcnJvciB7fVxuXG4vLyBTZWxmLXZhbGlkYXRpbmcvbm9ybWFsaXppbmcgY29uZmlnIGRhdGEgdHlwZXMgaW1wbGVtZW50IHRoaXMgVmFsaWRhdGVkQ29uZmlnRmllbGQgaW50ZXJmYWNlLlxuLy8gQ29uc3RydWN0b3JzIHRha2Ugc29tZSBkYXRhLCB2YWxpZGF0ZSwgbm9ybWFsaXplLCBhbmQgc3RvcmUgaWYgdmFsaWQsIG9yIHRocm93IG90aGVyd2lzZS5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7fVxuXG5mdW5jdGlvbiB0aHJvd0Vycm9yRm9ySW52YWxpZEZpZWxkKG5hbWU6IHN0cmluZywgdmFsdWU6IHt9LCByZWFzb24/OiBzdHJpbmcpIHtcbiAgdGhyb3cgbmV3IEludmFsaWRDb25maWdGaWVsZChgSW52YWxpZCAke25hbWV9OiAke3ZhbHVlfSAke3JlYXNvbiB8fCAnJ31gKTtcbn1cblxuZXhwb3J0IGNsYXNzIEhvc3QgZXh0ZW5kcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7XG4gIHB1YmxpYyBzdGF0aWMgSVBWNF9QQVRURVJOID0gL14oPzpbMC05XXsxLDN9XFwuKXszfVswLTldezEsM30kLztcbiAgcHVibGljIHN0YXRpYyBJUFY2X1BBVFRFUk4gPSAvXig/OltBLUYwLTldezEsNH06KXs3fVtBLUYwLTldezEsNH0kL2k7XG4gIHB1YmxpYyBzdGF0aWMgSE9TVE5BTUVfUEFUVEVSTiA9IC9eW0EtejAtOV0rW0EtejAtOV8uLV0qJC87XG4gIHB1YmxpYyByZWFkb25seSBkYXRhOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBpc0lQdjQ6IGJvb2xlYW47XG4gIHB1YmxpYyByZWFkb25seSBpc0lQdjY6IGJvb2xlYW47XG4gIHB1YmxpYyByZWFkb25seSBpc0hvc3RuYW1lOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKGhvc3Q6IEhvc3QgfCBzdHJpbmcpIHtcbiAgICBzdXBlcigpO1xuICAgIGlmICghaG9zdCkge1xuICAgICAgdGhyb3dFcnJvckZvckludmFsaWRGaWVsZCgnaG9zdCcsIGhvc3QpO1xuICAgIH1cbiAgICBpZiAoaG9zdCBpbnN0YW5jZW9mIEhvc3QpIHtcbiAgICAgIGhvc3QgPSBob3N0LmRhdGE7XG4gICAgfVxuICAgIGhvc3QgPSBwdW55Y29kZS50b0FTQ0lJKGhvc3QpIGFzIHN0cmluZztcbiAgICB0aGlzLmlzSVB2NCA9IEhvc3QuSVBWNF9QQVRURVJOLnRlc3QoaG9zdCk7XG4gICAgdGhpcy5pc0lQdjYgPSB0aGlzLmlzSVB2NCA/IGZhbHNlIDogSG9zdC5JUFY2X1BBVFRFUk4udGVzdChob3N0KTtcbiAgICB0aGlzLmlzSG9zdG5hbWUgPSB0aGlzLmlzSVB2NCB8fCB0aGlzLmlzSVB2NiA/IGZhbHNlIDogSG9zdC5IT1NUTkFNRV9QQVRURVJOLnRlc3QoaG9zdCk7XG4gICAgaWYgKCEodGhpcy5pc0lQdjQgfHwgdGhpcy5pc0lQdjYgfHwgdGhpcy5pc0hvc3RuYW1lKSkge1xuICAgICAgdGhyb3dFcnJvckZvckludmFsaWRGaWVsZCgnaG9zdCcsIGhvc3QpO1xuICAgIH1cbiAgICB0aGlzLmRhdGEgPSBob3N0O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQb3J0IGV4dGVuZHMgVmFsaWRhdGVkQ29uZmlnRmllbGQge1xuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFBBVFRFUk4gPSAvXlswLTldezEsNX0kLztcbiAgcHVibGljIHJlYWRvbmx5IGRhdGE6IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihwb3J0OiBQb3J0IHwgc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgc3VwZXIoKTtcbiAgICBpZiAocG9ydCBpbnN0YW5jZW9mIFBvcnQpIHtcbiAgICAgIHBvcnQgPSBwb3J0LmRhdGE7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcG9ydCA9PT0gJ251bWJlcicpIHtcbiAgICAgIC8vIFN0cmluZ2lmeSBpbiBjYXNlIG5lZ2F0aXZlIG9yIGZsb2F0aW5nIHBvaW50IC0+IHRoZSByZWdleCB0ZXN0IGJlbG93IHdpbGwgY2F0Y2guXG4gICAgICBwb3J0ID0gcG9ydC50b1N0cmluZygpO1xuICAgIH1cbiAgICBpZiAoIVBvcnQuUEFUVEVSTi50ZXN0KHBvcnQpKSB7XG4gICAgICB0aHJvd0Vycm9yRm9ySW52YWxpZEZpZWxkKCdwb3J0JywgcG9ydCk7XG4gICAgfVxuICAgIC8vIENvdWxkIGV4Y2VlZCB0aGUgbWF4aW11bSBwb3J0IG51bWJlciwgc28gY29udmVydCB0byBOdW1iZXIgdG8gY2hlY2suIENvdWxkIGFsc28gaGF2ZSBsZWFkaW5nXG4gICAgLy8gemVyb3MuIENvbnZlcnRpbmcgdG8gTnVtYmVyIGRyb3BzIHRob3NlLCBzbyB3ZSBnZXQgbm9ybWFsaXphdGlvbiBmb3IgZnJlZS4gOilcbiAgICBwb3J0ID0gTnVtYmVyKHBvcnQpO1xuICAgIGlmIChwb3J0ID4gNjU1MzUpIHtcbiAgICAgIHRocm93RXJyb3JGb3JJbnZhbGlkRmllbGQoJ3BvcnQnLCBwb3J0KTtcbiAgICB9XG4gICAgdGhpcy5kYXRhID0gcG9ydDtcbiAgfVxufVxuXG4vLyBBIG1ldGhvZCB2YWx1ZSBtdXN0IGV4YWN0bHkgbWF0Y2ggYW4gZWxlbWVudCBpbiB0aGUgc2V0IG9mIGtub3duIGNpcGhlcnMuXG4vLyByZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9zaGFkb3dzb2Nrcy9zaGFkb3dzb2Nrcy1saWJldi9ibG9iLzEwYTJkM2UzL2NvbXBsZXRpb25zL2Jhc2gvc3MtcmVkaXIjTDVcbmV4cG9ydCBjb25zdCBNRVRIT0RTID0gbmV3IFNldChbXG4gICdyYzQtbWQ1JyxcbiAgJ2Flcy0xMjgtZ2NtJyxcbiAgJ2Flcy0xOTItZ2NtJyxcbiAgJ2Flcy0yNTYtZ2NtJyxcbiAgJ2Flcy0xMjgtY2ZiJyxcbiAgJ2Flcy0xOTItY2ZiJyxcbiAgJ2Flcy0yNTYtY2ZiJyxcbiAgJ2Flcy0xMjgtY3RyJyxcbiAgJ2Flcy0xOTItY3RyJyxcbiAgJ2Flcy0yNTYtY3RyJyxcbiAgJ2NhbWVsbGlhLTEyOC1jZmInLFxuICAnY2FtZWxsaWEtMTkyLWNmYicsXG4gICdjYW1lbGxpYS0yNTYtY2ZiJyxcbiAgJ2JmLWNmYicsXG4gICdjaGFjaGEyMC1pZXRmLXBvbHkxMzA1JyxcbiAgJ3NhbHNhMjAnLFxuICAnY2hhY2hhMjAnLFxuICAnY2hhY2hhMjAtaWV0ZicsXG5dKTtcblxuZXhwb3J0IGNsYXNzIE1ldGhvZCBleHRlbmRzIFZhbGlkYXRlZENvbmZpZ0ZpZWxkIHtcbiAgcHVibGljIHJlYWRvbmx5IGRhdGE6IHN0cmluZztcbiAgY29uc3RydWN0b3IobWV0aG9kOiBNZXRob2QgfCBzdHJpbmcpIHtcbiAgICBzdXBlcigpO1xuICAgIGlmIChtZXRob2QgaW5zdGFuY2VvZiBNZXRob2QpIHtcbiAgICAgIG1ldGhvZCA9IG1ldGhvZC5kYXRhO1xuICAgIH1cbiAgICBpZiAoIU1FVEhPRFMuaGFzKG1ldGhvZCkpIHtcbiAgICAgIHRocm93RXJyb3JGb3JJbnZhbGlkRmllbGQoJ21ldGhvZCcsIG1ldGhvZCk7XG4gICAgfVxuICAgIHRoaXMuZGF0YSA9IG1ldGhvZDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGFzc3dvcmQgZXh0ZW5kcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7XG4gIHB1YmxpYyByZWFkb25seSBkYXRhOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocGFzc3dvcmQ6IFBhc3N3b3JkIHwgc3RyaW5nKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmRhdGEgPSBwYXNzd29yZCBpbnN0YW5jZW9mIFBhc3N3b3JkID8gcGFzc3dvcmQuZGF0YSA6IHBhc3N3b3JkO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUYWcgZXh0ZW5kcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7XG4gIHB1YmxpYyByZWFkb25seSBkYXRhOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IodGFnOiBUYWcgfCBzdHJpbmcgPSAnJykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5kYXRhID0gdGFnIGluc3RhbmNlb2YgVGFnID8gdGFnLmRhdGEgOiB0YWc7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWcge1xuICBob3N0OiBIb3N0O1xuICBwb3J0OiBQb3J0O1xuICBtZXRob2Q6IE1ldGhvZDtcbiAgcGFzc3dvcmQ6IFBhc3N3b3JkO1xuICB0YWc6IFRhZztcbiAgLy8gQW55IGFkZGl0aW9uYWwgY29uZmlndXJhdGlvbiAoZS5nLiBgdGltZW91dGAsIFNJUDAwMyBgcGx1Z2luYCwgZXRjLikgbWF5IGJlIHN0b3JlZCBoZXJlLlxuICBleHRyYToge1trZXk6IHN0cmluZ106IHN0cmluZ307XG59XG5cbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbmV4cG9ydCBmdW5jdGlvbiBtYWtlQ29uZmlnKGlucHV0OiB7W2tleTogc3RyaW5nXTogYW55fSk6IENvbmZpZyB7XG4gIC8vIFVzZSBcIiFcIiBmb3IgdGhlIHJlcXVpcmVkIGZpZWxkcyB0byB0ZWxsIHRzYyB0aGF0IHdlIGhhbmRsZSB1bmRlZmluZWQgaW4gdGhlXG4gIC8vIFZhbGlkYXRlZENvbmZpZ0ZpZWxkcyB3ZSBjYWxsOyB0c2MgY2FuJ3QgZmlndXJlIHRoYXQgb3V0IG90aGVyd2lzZS5cbiAgY29uc3QgY29uZmlnID0ge1xuICAgIGhvc3Q6IG5ldyBIb3N0KGlucHV0Lmhvc3QhKSxcbiAgICBwb3J0OiBuZXcgUG9ydChpbnB1dC5wb3J0ISksXG4gICAgbWV0aG9kOiBuZXcgTWV0aG9kKGlucHV0Lm1ldGhvZCEpLFxuICAgIHBhc3N3b3JkOiBuZXcgUGFzc3dvcmQoaW5wdXQucGFzc3dvcmQhKSxcbiAgICB0YWc6IG5ldyBUYWcoaW5wdXQudGFnKSwgIC8vIGlucHV0LnRhZyBtaWdodCBiZSB1bmRlZmluZWQgYnV0IFRhZygpIGhhbmRsZXMgdGhhdCBmaW5lLlxuICAgIGV4dHJhOiB7fSBhcyB7W2tleTogc3RyaW5nXTogc3RyaW5nfSxcbiAgfTtcbiAgLy8gUHV0IGFueSByZW1haW5pbmcgZmllbGRzIGluIGBpbnB1dGAgaW50byBgY29uZmlnLmV4dHJhYC5cbiAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoaW5wdXQpKSB7XG4gICAgaWYgKCEvXihob3N0fHBvcnR8bWV0aG9kfHBhc3N3b3JkfHRhZykkLy50ZXN0KGtleSkpIHtcbiAgICAgIGNvbmZpZy5leHRyYVtrZXldID0gaW5wdXRba2V5XSAmJiBpbnB1dFtrZXldLnRvU3RyaW5nKCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjb25maWc7XG59XG5cbmV4cG9ydCBjb25zdCBTSEFET1dTT0NLU19VUkkgPSB7XG4gIFBST1RPQ09MOiAnc3M6JyxcblxuICBnZXRVcmlGb3JtYXR0ZWRIb3N0OiAoaG9zdDogSG9zdCkgPT4ge1xuICAgIHJldHVybiBob3N0LmlzSVB2NiA/IGBbJHtob3N0LmRhdGF9XWAgOiBob3N0LmRhdGE7XG4gIH0sXG5cbiAgZ2V0SGFzaDogKHRhZzogVGFnKSA9PiB7XG4gICAgcmV0dXJuIHRhZy5kYXRhID8gYCMke2VuY29kZVVSSUNvbXBvbmVudCh0YWcuZGF0YSl9YCA6ICcnO1xuICB9LFxuXG4gIHZhbGlkYXRlUHJvdG9jb2w6ICh1cmk6IHN0cmluZykgPT4ge1xuICAgIGlmICghdXJpLnN0YXJ0c1dpdGgoU0hBRE9XU09DS1NfVVJJLlBST1RPQ09MKSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVcmkoYFVSSSBtdXN0IHN0YXJ0IHdpdGggXCIke1NIQURPV1NPQ0tTX1VSSS5QUk9UT0NPTH1cIjogJHt1cml9YCk7XG4gICAgfVxuICB9LFxuXG4gIHBhcnNlOiAodXJpOiBzdHJpbmcpOiBDb25maWcgPT4ge1xuICAgIGxldCBlcnJvcjogRXJyb3IgfCB1bmRlZmluZWQ7XG4gICAgZm9yIChjb25zdCB1cmlUeXBlIG9mIFtTSVAwMDJfVVJJLCBMRUdBQ1lfQkFTRTY0X1VSSV0pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB1cmlUeXBlLnBhcnNlKHVyaSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGVycm9yID0gZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBJbnZhbGlkVXJpKSkge1xuICAgICAgY29uc3Qgb3JpZ2luYWxFcnJvck5hbWUgPSBlcnJvciEubmFtZSEgfHwgJyhVbm5hbWVkIEVycm9yKSc7XG4gICAgICBjb25zdCBvcmlnaW5hbEVycm9yTWVzc2FnZSA9IGVycm9yIS5tZXNzYWdlISB8fCAnKG5vIGVycm9yIG1lc3NhZ2UgcHJvdmlkZWQpJztcbiAgICAgIGNvbnN0IG9yaWdpbmFsRXJyb3JTdHJpbmcgPSBgJHtvcmlnaW5hbEVycm9yTmFtZX06ICR7b3JpZ2luYWxFcnJvck1lc3NhZ2V9YDtcbiAgICAgIGNvbnN0IG5ld0Vycm9yTWVzc2FnZSA9IGBJbnZhbGlkIGlucHV0OiAke3VyaX0gLSBPcmlnaW5hbCBlcnJvcjogJHtvcmlnaW5hbEVycm9yU3RyaW5nfWA7XG4gICAgICBlcnJvciA9IG5ldyBJbnZhbGlkVXJpKG5ld0Vycm9yTWVzc2FnZSk7XG4gICAgfVxuICAgIHRocm93IGVycm9yO1xuICB9LFxufTtcblxuLy8gUmVmOiBodHRwczovL3NoYWRvd3NvY2tzLm9yZy9lbi9jb25maWcvcXVpY2stZ3VpZGUuaHRtbFxuZXhwb3J0IGNvbnN0IExFR0FDWV9CQVNFNjRfVVJJID0ge1xuICBwYXJzZTogKHVyaTogc3RyaW5nKTogQ29uZmlnID0+IHtcbiAgICBTSEFET1dTT0NLU19VUkkudmFsaWRhdGVQcm90b2NvbCh1cmkpO1xuICAgIGNvbnN0IGhhc2hJbmRleCA9IHVyaS5pbmRleE9mKCcjJyk7XG4gICAgY29uc3QgaGFzVGFnID0gaGFzaEluZGV4ICE9PSAtMTtcbiAgICBjb25zdCBiNjRFbmRJbmRleCA9IGhhc1RhZyA/IGhhc2hJbmRleCA6IHVyaS5sZW5ndGg7XG4gICAgY29uc3QgdGFnU3RhcnRJbmRleCA9IGhhc1RhZyA/IGhhc2hJbmRleCArIDEgOiB1cmkubGVuZ3RoO1xuICAgIGNvbnN0IHRhZyA9IG5ldyBUYWcoZGVjb2RlVVJJQ29tcG9uZW50KHVyaS5zdWJzdHJpbmcodGFnU3RhcnRJbmRleCkpKTtcbiAgICBjb25zdCBiNjRFbmNvZGVkRGF0YSA9IHVyaS5zdWJzdHJpbmcoJ3NzOi8vJy5sZW5ndGgsIGI2NEVuZEluZGV4KTtcbiAgICBjb25zdCBiNjREZWNvZGVkRGF0YSA9IGI2NERlY29kZShiNjRFbmNvZGVkRGF0YSk7XG4gICAgY29uc3QgYXRTaWduSW5kZXggPSBiNjREZWNvZGVkRGF0YS5pbmRleE9mKCdAJyk7XG4gICAgaWYgKGF0U2lnbkluZGV4ID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVcmkoYE1pc3NpbmcgXCJAXCI6ICR7YjY0RGVjb2RlZERhdGF9YCk7XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZEFuZFBhc3N3b3JkID0gYjY0RGVjb2RlZERhdGEuc3Vic3RyaW5nKDAsIGF0U2lnbkluZGV4KTtcbiAgICBjb25zdCBtZXRob2RFbmRJbmRleCA9IG1ldGhvZEFuZFBhc3N3b3JkLmluZGV4T2YoJzonKTtcbiAgICBpZiAobWV0aG9kRW5kSW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVyaShgTWlzc2luZyBwYXNzd29yZCBwYXJ0OiAke21ldGhvZEFuZFBhc3N3b3JkfWApO1xuICAgIH1cbiAgICBjb25zdCBtZXRob2RTdHJpbmcgPSBtZXRob2RBbmRQYXNzd29yZC5zdWJzdHJpbmcoMCwgbWV0aG9kRW5kSW5kZXgpO1xuICAgIGNvbnN0IG1ldGhvZCA9IG5ldyBNZXRob2QobWV0aG9kU3RyaW5nKTtcbiAgICBjb25zdCBwYXNzd29yZFN0YXJ0SW5kZXggPSBtZXRob2RFbmRJbmRleCArIDE7XG4gICAgY29uc3QgcGFzc3dvcmRTdHJpbmcgPSBtZXRob2RBbmRQYXNzd29yZC5zdWJzdHJpbmcocGFzc3dvcmRTdGFydEluZGV4KTtcbiAgICBjb25zdCBwYXNzd29yZCA9IG5ldyBQYXNzd29yZChwYXNzd29yZFN0cmluZyk7XG4gICAgY29uc3QgaG9zdFN0YXJ0SW5kZXggPSBhdFNpZ25JbmRleCArIDE7XG4gICAgY29uc3QgaG9zdEFuZFBvcnQgPSBiNjREZWNvZGVkRGF0YS5zdWJzdHJpbmcoaG9zdFN0YXJ0SW5kZXgpO1xuICAgIGNvbnN0IGhvc3RFbmRJbmRleCA9IGhvc3RBbmRQb3J0Lmxhc3RJbmRleE9mKCc6Jyk7XG4gICAgaWYgKGhvc3RFbmRJbmRleCA9PT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBJbnZhbGlkVXJpKGBNaXNzaW5nIHBvcnQgcGFydDogJHtob3N0QW5kUG9ydH1gKTtcbiAgICB9XG4gICAgY29uc3QgdXJpRm9ybWF0dGVkSG9zdCA9IGhvc3RBbmRQb3J0LnN1YnN0cmluZygwLCBob3N0RW5kSW5kZXgpO1xuICAgIGxldCBob3N0OiBIb3N0O1xuICAgIHRyeSB7XG4gICAgICBob3N0ID0gbmV3IEhvc3QodXJpRm9ybWF0dGVkSG9zdCk7XG4gICAgfSBjYXRjaCAoXykge1xuICAgICAgLy8gQ291bGQgYmUgSVB2NiBob3N0IGZvcm1hdHRlZCB3aXRoIHN1cnJvdW5kaW5nIGJyYWNrZXRzLCBzbyB0cnkgc3RyaXBwaW5nIGZpcnN0IGFuZCBsYXN0XG4gICAgICAvLyBjaGFyYWN0ZXJzLiBJZiB0aGlzIHRocm93cywgZ2l2ZSB1cCBhbmQgbGV0IHRoZSBleGNlcHRpb24gcHJvcGFnYXRlLlxuICAgICAgaG9zdCA9IG5ldyBIb3N0KHVyaUZvcm1hdHRlZEhvc3Quc3Vic3RyaW5nKDEsIHVyaUZvcm1hdHRlZEhvc3QubGVuZ3RoIC0gMSkpO1xuICAgIH1cbiAgICBjb25zdCBwb3J0U3RhcnRJbmRleCA9IGhvc3RFbmRJbmRleCArIDE7XG4gICAgY29uc3QgcG9ydFN0cmluZyA9IGhvc3RBbmRQb3J0LnN1YnN0cmluZyhwb3J0U3RhcnRJbmRleCk7XG4gICAgY29uc3QgcG9ydCA9IG5ldyBQb3J0KHBvcnRTdHJpbmcpO1xuICAgIGNvbnN0IGV4dHJhID0ge30gYXMge1trZXk6IHN0cmluZ106IHN0cmluZ307ICAvLyBlbXB0eSBiZWNhdXNlIExlZ2FjeUJhc2U2NFVyaSBjYW4ndCBob2xkIGV4dHJhXG4gICAgcmV0dXJuIHttZXRob2QsIHBhc3N3b3JkLCBob3N0LCBwb3J0LCB0YWcsIGV4dHJhfTtcbiAgfSxcblxuICBzdHJpbmdpZnk6IChjb25maWc6IENvbmZpZykgPT4ge1xuICAgIGNvbnN0IHtob3N0LCBwb3J0LCBtZXRob2QsIHBhc3N3b3JkLCB0YWd9ID0gY29uZmlnO1xuICAgIGNvbnN0IGhhc2ggPSBTSEFET1dTT0NLU19VUkkuZ2V0SGFzaCh0YWcpO1xuICAgIGxldCBiNjRFbmNvZGVkRGF0YSA9IGI2NEVuY29kZShgJHttZXRob2QuZGF0YX06JHtwYXNzd29yZC5kYXRhfUAke2hvc3QuZGF0YX06JHtwb3J0LmRhdGF9YCk7XG4gICAgY29uc3QgZGF0YUxlbmd0aCA9IGI2NEVuY29kZWREYXRhLmxlbmd0aDtcbiAgICBsZXQgcGFkZGluZ0xlbmd0aCA9IDA7XG4gICAgZm9yICg7IGI2NEVuY29kZWREYXRhW2RhdGFMZW5ndGggLSAxIC0gcGFkZGluZ0xlbmd0aF0gPT09ICc9JzsgcGFkZGluZ0xlbmd0aCsrKTtcbiAgICBiNjRFbmNvZGVkRGF0YSA9IHBhZGRpbmdMZW5ndGggPT09IDAgPyBiNjRFbmNvZGVkRGF0YSA6XG4gICAgICAgIGI2NEVuY29kZWREYXRhLnN1YnN0cmluZygwLCBkYXRhTGVuZ3RoIC0gcGFkZGluZ0xlbmd0aCk7XG4gICAgcmV0dXJuIGBzczovLyR7YjY0RW5jb2RlZERhdGF9JHtoYXNofWA7XG4gIH0sXG59O1xuXG4vLyBSZWY6IGh0dHBzOi8vc2hhZG93c29ja3Mub3JnL2VuL3NwZWMvU0lQMDAyLVVSSS1TY2hlbWUuaHRtbFxuZXhwb3J0IGNvbnN0IFNJUDAwMl9VUkkgPSB7XG4gIHBhcnNlOiAodXJpOiBzdHJpbmcpOiBDb25maWcgPT4ge1xuICAgIFNIQURPV1NPQ0tTX1VSSS52YWxpZGF0ZVByb3RvY29sKHVyaSk7XG4gICAgLy8gQ2FuIHVzZSBidWlsdC1pbiBVUkwgcGFyc2VyIGZvciBleHBlZGllbmNlLiBKdXN0IGhhdmUgdG8gcmVwbGFjZSBcInNzXCIgd2l0aCBcImh0dHBcIiB0byBlbnN1cmVcbiAgICAvLyBjb3JyZWN0IHJlc3VsdHMuXG4gICAgY29uc3QgaW5wdXRGb3JVcmxQYXJzZXIgPSBgaHR0cCR7dXJpLnN1YnN0cmluZygyKX1gO1xuICAgIC8vIFRoZSBidWlsdC1pbiBVUkwgcGFyc2VyIHRocm93cyBhcyBkZXNpcmVkIHdoZW4gZ2l2ZW4gVVJJcyB3aXRoIGludmFsaWQgc3ludGF4LlxuICAgIGNvbnN0IHVybFBhcnNlclJlc3VsdCA9IG5ldyBVUkwoaW5wdXRGb3JVcmxQYXJzZXIpO1xuICAgIGNvbnN0IHVyaUZvcm1hdHRlZEhvc3QgPSB1cmxQYXJzZXJSZXN1bHQuaG9zdG5hbWU7XG4gICAgLy8gVVJJLWZvcm1hdHRlZCBJUHY2IGhvc3RuYW1lcyBoYXZlIHN1cnJvdW5kaW5nIGJyYWNrZXRzLlxuICAgIGNvbnN0IGxhc3QgPSB1cmlGb3JtYXR0ZWRIb3N0Lmxlbmd0aCAtIDE7XG4gICAgY29uc3QgYnJhY2tldHMgPSB1cmlGb3JtYXR0ZWRIb3N0WzBdID09PSAnWycgJiYgdXJpRm9ybWF0dGVkSG9zdFtsYXN0XSA9PT0gJ10nO1xuICAgIGNvbnN0IGhvc3RTdHJpbmcgPSBicmFja2V0cyA/IHVyaUZvcm1hdHRlZEhvc3Quc3Vic3RyaW5nKDEsIGxhc3QpIDogdXJpRm9ybWF0dGVkSG9zdDtcbiAgICBjb25zdCBob3N0ID0gbmV3IEhvc3QoaG9zdFN0cmluZyk7XG4gICAgY29uc3QgcG9ydCA9IG5ldyBQb3J0KHVybFBhcnNlclJlc3VsdC5wb3J0KTtcbiAgICBjb25zdCB0YWcgPSBuZXcgVGFnKGRlY29kZVVSSUNvbXBvbmVudCh1cmxQYXJzZXJSZXN1bHQuaGFzaC5zdWJzdHJpbmcoMSkpKTtcbiAgICBjb25zdCBiNjRFbmNvZGVkVXNlckluZm8gPSB1cmxQYXJzZXJSZXN1bHQudXNlcm5hbWUucmVwbGFjZSgvJTNEL2csICc9Jyk7XG4gICAgLy8gYmFzZTY0LmRlY29kZSB0aHJvd3MgYXMgZGVzaXJlZCB3aGVuIGdpdmVuIGludmFsaWQgYmFzZTY0IGlucHV0LlxuICAgIGNvbnN0IGI2NERlY29kZWRVc2VySW5mbyA9IGI2NERlY29kZShiNjRFbmNvZGVkVXNlckluZm8pO1xuICAgIGNvbnN0IGNvbG9uSWR4ID0gYjY0RGVjb2RlZFVzZXJJbmZvLmluZGV4T2YoJzonKTtcbiAgICBpZiAoY29sb25JZHggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVyaShgTWlzc2luZyBwYXNzd29yZCBwYXJ0OiAke2I2NERlY29kZWRVc2VySW5mb31gKTtcbiAgICB9XG4gICAgY29uc3QgbWV0aG9kU3RyaW5nID0gYjY0RGVjb2RlZFVzZXJJbmZvLnN1YnN0cmluZygwLCBjb2xvbklkeCk7XG4gICAgY29uc3QgbWV0aG9kID0gbmV3IE1ldGhvZChtZXRob2RTdHJpbmcpO1xuICAgIGNvbnN0IHBhc3N3b3JkU3RyaW5nID0gYjY0RGVjb2RlZFVzZXJJbmZvLnN1YnN0cmluZyhjb2xvbklkeCArIDEpO1xuICAgIGNvbnN0IHBhc3N3b3JkID0gbmV3IFBhc3N3b3JkKHBhc3N3b3JkU3RyaW5nKTtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHVybFBhcnNlclJlc3VsdC5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XG4gICAgY29uc3QgZXh0cmEgPSB7fSBhcyB7W2tleTogc3RyaW5nXTogc3RyaW5nfTtcbiAgICBmb3IgKGNvbnN0IHBhaXIgb2YgcXVlcnlQYXJhbXMpIHtcbiAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IHBhaXIuc3BsaXQoJz0nLCAyKTtcbiAgICAgIGlmICgha2V5KSBjb250aW51ZTtcbiAgICAgIGV4dHJhW2tleV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUgfHwgJycpO1xuICAgIH1cbiAgICByZXR1cm4ge21ldGhvZCwgcGFzc3dvcmQsIGhvc3QsIHBvcnQsIHRhZywgZXh0cmF9O1xuICB9LFxuXG4gIHN0cmluZ2lmeTogKGNvbmZpZzogQ29uZmlnKSA9PiB7XG4gICAgY29uc3Qge2hvc3QsIHBvcnQsIG1ldGhvZCwgcGFzc3dvcmQsIHRhZywgZXh0cmF9ID0gY29uZmlnO1xuICAgIGNvbnN0IHVzZXJJbmZvID0gYjY0RW5jb2RlKGAke21ldGhvZC5kYXRhfToke3Bhc3N3b3JkLmRhdGF9YCk7XG4gICAgY29uc3QgdXJpSG9zdCA9IFNIQURPV1NPQ0tTX1VSSS5nZXRVcmlGb3JtYXR0ZWRIb3N0KGhvc3QpO1xuICAgIGNvbnN0IGhhc2ggPSBTSEFET1dTT0NLU19VUkkuZ2V0SGFzaCh0YWcpO1xuICAgIGxldCBxdWVyeVN0cmluZyA9ICcnO1xuICAgIGZvciAoY29uc3Qga2V5IGluIGV4dHJhKSB7XG4gICAgICBpZiAoIWtleSkgY29udGludWU7XG4gICAgICBxdWVyeVN0cmluZyArPSAocXVlcnlTdHJpbmcgPyAnJicgOiAnPycpICsgYCR7a2V5fT0ke2VuY29kZVVSSUNvbXBvbmVudChleHRyYVtrZXldKX1gO1xuICAgIH1cbiAgICByZXR1cm4gYHNzOi8vJHt1c2VySW5mb31AJHt1cmlIb3N0fToke3BvcnQuZGF0YX0vJHtxdWVyeVN0cmluZ30ke2hhc2h9YDtcbiAgfSxcbn07XG4iXX0=
