"use strict";
(function iife() {
  const platformExportObj = (function detectPlatformExportObj() {
    if (typeof module !== 'undefined' && module.exports) {
      return module.exports;  // node
    } else if (typeof window !== 'undefined') {
      return window;  // browser
    }
    throw new Error('Could not detect platform global object (no window or module.exports)');
  })();
const isBrowser = typeof window !== 'undefined';
const b64Encode = isBrowser ? btoa : require('base-64').encode;
const b64Decode = isBrowser ? atob : require('base-64').decode;
const URL = isBrowser ? window.URL : require('url').URL;
const punycode = isBrowser ? window.punycode : require('punycode');
class ShadowsocksConfigError extends Error {
    constructor(message) {
        super(message);
        Object.setPrototypeOf(this, new.target.prototype);
        this.name = new.target.name;
    }
}
platformExportObj.ShadowsocksConfigError = ShadowsocksConfigError;
class InvalidConfigField extends ShadowsocksConfigError {
}
platformExportObj.InvalidConfigField = InvalidConfigField;
class InvalidUri extends ShadowsocksConfigError {
}
platformExportObj.InvalidUri = InvalidUri;
class ValidatedConfigField {
}
platformExportObj.ValidatedConfigField = ValidatedConfigField;
function throwErrorForInvalidField(name, value, reason) {
    throw new InvalidConfigField(`Invalid ${name}: ${value} ${reason || ''}`);
}
class Host extends ValidatedConfigField {
    constructor(host) {
        super();
        if (!host) {
            throwErrorForInvalidField('host', host);
        }
        if (host instanceof Host) {
            host = host.data;
        }
        host = punycode.toASCII(host);
        this.isIPv4 = Host.IPV4_PATTERN.test(host);
        this.isIPv6 = this.isIPv4 ? false : Host.IPV6_PATTERN.test(host);
        this.isHostname = this.isIPv4 || this.isIPv6 ? false : Host.HOSTNAME_PATTERN.test(host);
        if (!(this.isIPv4 || this.isIPv6 || this.isHostname)) {
            throwErrorForInvalidField('host', host);
        }
        this.data = host;
    }
}
Host.IPV4_PATTERN = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
Host.IPV6_PATTERN = /^(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}$/i;
Host.HOSTNAME_PATTERN = /^[A-z0-9]+[A-z0-9_.-]*$/;
platformExportObj.Host = Host;
class Port extends ValidatedConfigField {
    constructor(port) {
        super();
        if (port instanceof Port) {
            port = port.data;
        }
        if (typeof port === 'number') {
            port = port.toString();
        }
        if (!Port.PATTERN.test(port)) {
            throwErrorForInvalidField('port', port);
        }
        port = Number(port);
        if (port > 65535) {
            throwErrorForInvalidField('port', port);
        }
        this.data = port;
    }
}
Port.PATTERN = /^[0-9]{1,5}$/;
platformExportObj.Port = Port;
platformExportObj.METHODS = new Set([
    'rc4-md5',
    'aes-128-gcm',
    'aes-192-gcm',
    'aes-256-gcm',
    'aes-128-cfb',
    'aes-192-cfb',
    'aes-256-cfb',
    'aes-128-ctr',
    'aes-192-ctr',
    'aes-256-ctr',
    'camellia-128-cfb',
    'camellia-192-cfb',
    'camellia-256-cfb',
    'bf-cfb',
    'chacha20-ietf-poly1305',
    'salsa20',
    'chacha20',
    'chacha20-ietf',
]);
class Method extends ValidatedConfigField {
    constructor(method) {
        super();
        if (method instanceof Method) {
            method = method.data;
        }
        if (!platformExportObj.METHODS.has(method)) {
            throwErrorForInvalidField('method', method);
        }
        this.data = method;
    }
}
platformExportObj.Method = Method;
class Password extends ValidatedConfigField {
    constructor(password) {
        super();
        this.data = password instanceof Password ? password.data : password;
    }
}
platformExportObj.Password = Password;
class Tag extends ValidatedConfigField {
    constructor(tag = '') {
        super();
        this.data = tag instanceof Tag ? tag.data : tag;
    }
}
platformExportObj.Tag = Tag;
function makeConfig(input) {
    const config = {
        host: new Host(input.host),
        port: new Port(input.port),
        method: new Method(input.method),
        password: new Password(input.password),
        tag: new Tag(input.tag),
        extra: {},
    };
    for (const key of Object.keys(input)) {
        if (!/^(host|port|method|password|tag)$/.test(key)) {
            config.extra[key] = input[key] && input[key].toString();
        }
    }
    return config;
}
platformExportObj.makeConfig = makeConfig;
platformExportObj.SHADOWSOCKS_URI = {
    PROTOCOL: 'ss:',
    getUriFormattedHost: (host) => {
        return host.isIPv6 ? `[${host.data}]` : host.data;
    },
    getHash: (tag) => {
        return tag.data ? `#${encodeURIComponent(tag.data)}` : '';
    },
    validateProtocol: (uri) => {
        if (!uri.startsWith(platformExportObj.SHADOWSOCKS_URI.PROTOCOL)) {
            throw new InvalidUri(`URI must start with "${platformExportObj.SHADOWSOCKS_URI.PROTOCOL}": ${uri}`);
        }
    },
    parse: (uri) => {
        let error;
        for (const uriType of [platformExportObj.SIP002_URI, platformExportObj.LEGACY_BASE64_URI]) {
            try {
                return uriType.parse(uri);
            }
            catch (e) {
                error = e;
            }
        }
        if (!(error instanceof InvalidUri)) {
            const originalErrorName = error.name || '(Unnamed Error)';
            const originalErrorMessage = error.message || '(no error message provided)';
            const originalErrorString = `${originalErrorName}: ${originalErrorMessage}`;
            const newErrorMessage = `Invalid input: ${uri} - Original error: ${originalErrorString}`;
            error = new InvalidUri(newErrorMessage);
        }
        throw error;
    },
};
platformExportObj.LEGACY_BASE64_URI = {
    parse: (uri) => {
        platformExportObj.SHADOWSOCKS_URI.validateProtocol(uri);
        const hashIndex = uri.indexOf('#');
        const hasTag = hashIndex !== -1;
        const b64EndIndex = hasTag ? hashIndex : uri.length;
        const tagStartIndex = hasTag ? hashIndex + 1 : uri.length;
        const tag = new Tag(decodeURIComponent(uri.substring(tagStartIndex)));
        const b64EncodedData = uri.substring('ss://'.length, b64EndIndex);
        const b64DecodedData = b64Decode(b64EncodedData);
        const atSignIndex = b64DecodedData.indexOf('@');
        if (atSignIndex === -1) {
            throw new InvalidUri(`Missing "@": ${b64DecodedData}`);
        }
        const methodAndPassword = b64DecodedData.substring(0, atSignIndex);
        const methodEndIndex = methodAndPassword.indexOf(':');
        if (methodEndIndex === -1) {
            throw new InvalidUri(`Missing password part: ${methodAndPassword}`);
        }
        const methodString = methodAndPassword.substring(0, methodEndIndex);
        const method = new Method(methodString);
        const passwordStartIndex = methodEndIndex + 1;
        const passwordString = methodAndPassword.substring(passwordStartIndex);
        const password = new Password(passwordString);
        const hostStartIndex = atSignIndex + 1;
        const hostAndPort = b64DecodedData.substring(hostStartIndex);
        const hostEndIndex = hostAndPort.lastIndexOf(':');
        if (hostEndIndex === -1) {
            throw new InvalidUri(`Missing port part: ${hostAndPort}`);
        }
        const uriFormattedHost = hostAndPort.substring(0, hostEndIndex);
        let host;
        try {
            host = new Host(uriFormattedHost);
        }
        catch (_) {
            host = new Host(uriFormattedHost.substring(1, uriFormattedHost.length - 1));
        }
        const portStartIndex = hostEndIndex + 1;
        const portString = hostAndPort.substring(portStartIndex);
        const port = new Port(portString);
        const extra = {};
        return { method, password, host, port, tag, extra };
    },
    stringify: (config) => {
        const { host, port, method, password, tag } = config;
        const hash = platformExportObj.SHADOWSOCKS_URI.getHash(tag);
        let b64EncodedData = b64Encode(`${method.data}:${password.data}@${host.data}:${port.data}`);
        const dataLength = b64EncodedData.length;
        let paddingLength = 0;
        for (; b64EncodedData[dataLength - 1 - paddingLength] === '='; paddingLength++)
            ;
        b64EncodedData = paddingLength === 0 ? b64EncodedData :
            b64EncodedData.substring(0, dataLength - paddingLength);
        return `ss://${b64EncodedData}${hash}`;
    },
};
platformExportObj.SIP002_URI = {
    parse: (uri) => {
        platformExportObj.SHADOWSOCKS_URI.validateProtocol(uri);
        const inputForUrlParser = `http${uri.substring(2)}`;
        const urlParserResult = new URL(inputForUrlParser);
        const uriFormattedHost = urlParserResult.hostname;
        const last = uriFormattedHost.length - 1;
        const brackets = uriFormattedHost[0] === '[' && uriFormattedHost[last] === ']';
        const hostString = brackets ? uriFormattedHost.substring(1, last) : uriFormattedHost;
        const host = new Host(hostString);
        const port = new Port(urlParserResult.port);
        const tag = new Tag(decodeURIComponent(urlParserResult.hash.substring(1)));
        const b64EncodedUserInfo = urlParserResult.username.replace(/%3D/g, '=');
        const b64DecodedUserInfo = b64Decode(b64EncodedUserInfo);
        const colonIdx = b64DecodedUserInfo.indexOf(':');
        if (colonIdx === -1) {
            throw new InvalidUri(`Missing password part: ${b64DecodedUserInfo}`);
        }
        const methodString = b64DecodedUserInfo.substring(0, colonIdx);
        const method = new Method(methodString);
        const passwordString = b64DecodedUserInfo.substring(colonIdx + 1);
        const password = new Password(passwordString);
        const queryParams = urlParserResult.search.substring(1).split('&');
        const extra = {};
        for (const pair of queryParams) {
            const [key, value] = pair.split('=', 2);
            if (!key)
                continue;
            extra[key] = decodeURIComponent(value || '');
        }
        return { method, password, host, port, tag, extra };
    },
    stringify: (config) => {
        const { host, port, method, password, tag, extra } = config;
        const userInfo = b64Encode(`${method.data}:${password.data}`);
        const uriHost = platformExportObj.SHADOWSOCKS_URI.getUriFormattedHost(host);
        const hash = platformExportObj.SHADOWSOCKS_URI.getHash(tag);
        let queryString = '';
        for (const key in extra) {
            if (!key)
                continue;
            queryString += (queryString ? '&' : '?') + `${key}=${encodeURIComponent(extra[key])}`;
        }
        return `ss://${userInfo}@${uriHost}:${port.data}/${queryString}${hash}`;
    },
};
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,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bGUgKi9cbmNvbnN0IGlzQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnO1xuY29uc3QgYjY0RW5jb2RlID0gaXNCcm93c2VyID8gYnRvYSA6IHJlcXVpcmUoJ2Jhc2UtNjQnKS5lbmNvZGU7XG5jb25zdCBiNjREZWNvZGUgPSBpc0Jyb3dzZXIgPyBhdG9iIDogcmVxdWlyZSgnYmFzZS02NCcpLmRlY29kZTtcbmNvbnN0IFVSTCA9IGlzQnJvd3NlciA/IHdpbmRvdy5VUkwgOiByZXF1aXJlKCd1cmwnKS5VUkw7XG5jb25zdCBwdW55Y29kZSA9IGlzQnJvd3NlciA/ICh3aW5kb3cgYXMgYW55KS5wdW55Y29kZSA6IHJlcXVpcmUoJ3B1bnljb2RlJyk7XG4vKiB0c2xpbnQ6ZW5hYmxlICovXG5cbi8vIEN1c3RvbSBlcnJvciBiYXNlIGNsYXNzXG5leHBvcnQgY2xhc3MgU2hhZG93c29ja3NDb25maWdFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7ICAvLyAnRXJyb3InIGJyZWFrcyBwcm90b3R5cGUgY2hhaW4gaGVyZSBpZiB0aGlzIGlzIHRyYW5zcGlsZWQgdG8gZXM1XG4gICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIG5ldy50YXJnZXQucHJvdG90eXBlKTsgIC8vIHJlc3RvcmUgcHJvdG90eXBlIGNoYWluXG4gICAgdGhpcy5uYW1lID0gbmV3LnRhcmdldC5uYW1lO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnZhbGlkQ29uZmlnRmllbGQgZXh0ZW5kcyBTaGFkb3dzb2Nrc0NvbmZpZ0Vycm9yIHt9XG5cbmV4cG9ydCBjbGFzcyBJbnZhbGlkVXJpIGV4dGVuZHMgU2hhZG93c29ja3NDb25maWdFcnJvciB7fVxuXG4vLyBTZWxmLXZhbGlkYXRpbmcvbm9ybWFsaXppbmcgY29uZmlnIGRhdGEgdHlwZXMgaW1wbGVtZW50IHRoaXMgVmFsaWRhdGVkQ29uZmlnRmllbGQgaW50ZXJmYWNlLlxuLy8gQ29uc3RydWN0b3JzIHRha2Ugc29tZSBkYXRhLCB2YWxpZGF0ZSwgbm9ybWFsaXplLCBhbmQgc3RvcmUgaWYgdmFsaWQsIG9yIHRocm93IG90aGVyd2lzZS5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7fVxuXG5mdW5jdGlvbiB0aHJvd0Vycm9yRm9ySW52YWxpZEZpZWxkKG5hbWU6IHN0cmluZywgdmFsdWU6IHt9LCByZWFzb24/OiBzdHJpbmcpIHtcbiAgdGhyb3cgbmV3IEludmFsaWRDb25maWdGaWVsZChgSW52YWxpZCAke25hbWV9OiAke3ZhbHVlfSAke3JlYXNvbiB8fCAnJ31gKTtcbn1cblxuZXhwb3J0IGNsYXNzIEhvc3QgZXh0ZW5kcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7XG4gIHB1YmxpYyBzdGF0aWMgSVBWNF9QQVRURVJOID0gL14oPzpbMC05XXsxLDN9XFwuKXszfVswLTldezEsM30kLztcbiAgcHVibGljIHN0YXRpYyBJUFY2X1BBVFRFUk4gPSAvXig/OltBLUYwLTldezEsNH06KXs3fVtBLUYwLTldezEsNH0kL2k7XG4gIHB1YmxpYyBzdGF0aWMgSE9TVE5BTUVfUEFUVEVSTiA9IC9eW0EtejAtOV0rW0EtejAtOV8uLV0qJC87XG4gIHB1YmxpYyByZWFkb25seSBkYXRhOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBpc0lQdjQ6IGJvb2xlYW47XG4gIHB1YmxpYyByZWFkb25seSBpc0lQdjY6IGJvb2xlYW47XG4gIHB1YmxpYyByZWFkb25seSBpc0hvc3RuYW1lOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKGhvc3Q6IEhvc3QgfCBzdHJpbmcpIHtcbiAgICBzdXBlcigpO1xuICAgIGlmICghaG9zdCkge1xuICAgICAgdGhyb3dFcnJvckZvckludmFsaWRGaWVsZCgnaG9zdCcsIGhvc3QpO1xuICAgIH1cbiAgICBpZiAoaG9zdCBpbnN0YW5jZW9mIEhvc3QpIHtcbiAgICAgIGhvc3QgPSBob3N0LmRhdGE7XG4gICAgfVxuICAgIGhvc3QgPSBwdW55Y29kZS50b0FTQ0lJKGhvc3QpIGFzIHN0cmluZztcbiAgICB0aGlzLmlzSVB2NCA9IEhvc3QuSVBWNF9QQVRURVJOLnRlc3QoaG9zdCk7XG4gICAgdGhpcy5pc0lQdjYgPSB0aGlzLmlzSVB2NCA/IGZhbHNlIDogSG9zdC5JUFY2X1BBVFRFUk4udGVzdChob3N0KTtcbiAgICB0aGlzLmlzSG9zdG5hbWUgPSB0aGlzLmlzSVB2NCB8fCB0aGlzLmlzSVB2NiA/IGZhbHNlIDogSG9zdC5IT1NUTkFNRV9QQVRURVJOLnRlc3QoaG9zdCk7XG4gICAgaWYgKCEodGhpcy5pc0lQdjQgfHwgdGhpcy5pc0lQdjYgfHwgdGhpcy5pc0hvc3RuYW1lKSkge1xuICAgICAgdGhyb3dFcnJvckZvckludmFsaWRGaWVsZCgnaG9zdCcsIGhvc3QpO1xuICAgIH1cbiAgICB0aGlzLmRhdGEgPSBob3N0O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQb3J0IGV4dGVuZHMgVmFsaWRhdGVkQ29uZmlnRmllbGQge1xuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFBBVFRFUk4gPSAvXlswLTldezEsNX0kLztcbiAgcHVibGljIHJlYWRvbmx5IGRhdGE6IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihwb3J0OiBQb3J0IHwgc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgc3VwZXIoKTtcbiAgICBpZiAocG9ydCBpbnN0YW5jZW9mIFBvcnQpIHtcbiAgICAgIHBvcnQgPSBwb3J0LmRhdGE7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcG9ydCA9PT0gJ251bWJlcicpIHtcbiAgICAgIC8vIFN0cmluZ2lmeSBpbiBjYXNlIG5lZ2F0aXZlIG9yIGZsb2F0aW5nIHBvaW50IC0+IHRoZSByZWdleCB0ZXN0IGJlbG93IHdpbGwgY2F0Y2guXG4gICAgICBwb3J0ID0gcG9ydC50b1N0cmluZygpO1xuICAgIH1cbiAgICBpZiAoIVBvcnQuUEFUVEVSTi50ZXN0KHBvcnQpKSB7XG4gICAgICB0aHJvd0Vycm9yRm9ySW52YWxpZEZpZWxkKCdwb3J0JywgcG9ydCk7XG4gICAgfVxuICAgIC8vIENvdWxkIGV4Y2VlZCB0aGUgbWF4aW11bSBwb3J0IG51bWJlciwgc28gY29udmVydCB0byBOdW1iZXIgdG8gY2hlY2suIENvdWxkIGFsc28gaGF2ZSBsZWFkaW5nXG4gICAgLy8gemVyb3MuIENvbnZlcnRpbmcgdG8gTnVtYmVyIGRyb3BzIHRob3NlLCBzbyB3ZSBnZXQgbm9ybWFsaXphdGlvbiBmb3IgZnJlZS4gOilcbiAgICBwb3J0ID0gTnVtYmVyKHBvcnQpO1xuICAgIGlmIChwb3J0ID4gNjU1MzUpIHtcbiAgICAgIHRocm93RXJyb3JGb3JJbnZhbGlkRmllbGQoJ3BvcnQnLCBwb3J0KTtcbiAgICB9XG4gICAgdGhpcy5kYXRhID0gcG9ydDtcbiAgfVxufVxuXG4vLyBBIG1ldGhvZCB2YWx1ZSBtdXN0IGV4YWN0bHkgbWF0Y2ggYW4gZWxlbWVudCBpbiB0aGUgc2V0IG9mIGtub3duIGNpcGhlcnMuXG4vLyByZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9zaGFkb3dzb2Nrcy9zaGFkb3dzb2Nrcy1saWJldi9ibG9iLzEwYTJkM2UzL2NvbXBsZXRpb25zL2Jhc2gvc3MtcmVkaXIjTDVcbmV4cG9ydCBjb25zdCBNRVRIT0RTID0gbmV3IFNldChbXG4gICdyYzQtbWQ1JyxcbiAgJ2Flcy0xMjgtZ2NtJyxcbiAgJ2Flcy0xOTItZ2NtJyxcbiAgJ2Flcy0yNTYtZ2NtJyxcbiAgJ2Flcy0xMjgtY2ZiJyxcbiAgJ2Flcy0xOTItY2ZiJyxcbiAgJ2Flcy0yNTYtY2ZiJyxcbiAgJ2Flcy0xMjgtY3RyJyxcbiAgJ2Flcy0xOTItY3RyJyxcbiAgJ2Flcy0yNTYtY3RyJyxcbiAgJ2NhbWVsbGlhLTEyOC1jZmInLFxuICAnY2FtZWxsaWEtMTkyLWNmYicsXG4gICdjYW1lbGxpYS0yNTYtY2ZiJyxcbiAgJ2JmLWNmYicsXG4gICdjaGFjaGEyMC1pZXRmLXBvbHkxMzA1JyxcbiAgJ3NhbHNhMjAnLFxuICAnY2hhY2hhMjAnLFxuICAnY2hhY2hhMjAtaWV0ZicsXG5dKTtcblxuZXhwb3J0IGNsYXNzIE1ldGhvZCBleHRlbmRzIFZhbGlkYXRlZENvbmZpZ0ZpZWxkIHtcbiAgcHVibGljIHJlYWRvbmx5IGRhdGE6IHN0cmluZztcbiAgY29uc3RydWN0b3IobWV0aG9kOiBNZXRob2QgfCBzdHJpbmcpIHtcbiAgICBzdXBlcigpO1xuICAgIGlmIChtZXRob2QgaW5zdGFuY2VvZiBNZXRob2QpIHtcbiAgICAgIG1ldGhvZCA9IG1ldGhvZC5kYXRhO1xuICAgIH1cbiAgICBpZiAoIU1FVEhPRFMuaGFzKG1ldGhvZCkpIHtcbiAgICAgIHRocm93RXJyb3JGb3JJbnZhbGlkRmllbGQoJ21ldGhvZCcsIG1ldGhvZCk7XG4gICAgfVxuICAgIHRoaXMuZGF0YSA9IG1ldGhvZDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGFzc3dvcmQgZXh0ZW5kcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7XG4gIHB1YmxpYyByZWFkb25seSBkYXRhOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocGFzc3dvcmQ6IFBhc3N3b3JkIHwgc3RyaW5nKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmRhdGEgPSBwYXNzd29yZCBpbnN0YW5jZW9mIFBhc3N3b3JkID8gcGFzc3dvcmQuZGF0YSA6IHBhc3N3b3JkO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUYWcgZXh0ZW5kcyBWYWxpZGF0ZWRDb25maWdGaWVsZCB7XG4gIHB1YmxpYyByZWFkb25seSBkYXRhOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IodGFnOiBUYWcgfCBzdHJpbmcgPSAnJykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5kYXRhID0gdGFnIGluc3RhbmNlb2YgVGFnID8gdGFnLmRhdGEgOiB0YWc7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWcge1xuICBob3N0OiBIb3N0O1xuICBwb3J0OiBQb3J0O1xuICBtZXRob2Q6IE1ldGhvZDtcbiAgcGFzc3dvcmQ6IFBhc3N3b3JkO1xuICB0YWc6IFRhZztcbiAgLy8gQW55IGFkZGl0aW9uYWwgY29uZmlndXJhdGlvbiAoZS5nLiBgdGltZW91dGAsIFNJUDAwMyBgcGx1Z2luYCwgZXRjLikgbWF5IGJlIHN0b3JlZCBoZXJlLlxuICBleHRyYToge1trZXk6IHN0cmluZ106IHN0cmluZ307XG59XG5cbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbmV4cG9ydCBmdW5jdGlvbiBtYWtlQ29uZmlnKGlucHV0OiB7W2tleTogc3RyaW5nXTogYW55fSk6IENvbmZpZyB7XG4gIC8vIFVzZSBcIiFcIiBmb3IgdGhlIHJlcXVpcmVkIGZpZWxkcyB0byB0ZWxsIHRzYyB0aGF0IHdlIGhhbmRsZSB1bmRlZmluZWQgaW4gdGhlXG4gIC8vIFZhbGlkYXRlZENvbmZpZ0ZpZWxkcyB3ZSBjYWxsOyB0c2MgY2FuJ3QgZmlndXJlIHRoYXQgb3V0IG90aGVyd2lzZS5cbiAgY29uc3QgY29uZmlnID0ge1xuICAgIGhvc3Q6IG5ldyBIb3N0KGlucHV0Lmhvc3QhKSxcbiAgICBwb3J0OiBuZXcgUG9ydChpbnB1dC5wb3J0ISksXG4gICAgbWV0aG9kOiBuZXcgTWV0aG9kKGlucHV0Lm1ldGhvZCEpLFxuICAgIHBhc3N3b3JkOiBuZXcgUGFzc3dvcmQoaW5wdXQucGFzc3dvcmQhKSxcbiAgICB0YWc6IG5ldyBUYWcoaW5wdXQudGFnKSwgIC8vIGlucHV0LnRhZyBtaWdodCBiZSB1bmRlZmluZWQgYnV0IFRhZygpIGhhbmRsZXMgdGhhdCBmaW5lLlxuICAgIGV4dHJhOiB7fSBhcyB7W2tleTogc3RyaW5nXTogc3RyaW5nfSxcbiAgfTtcbiAgLy8gUHV0IGFueSByZW1haW5pbmcgZmllbGRzIGluIGBpbnB1dGAgaW50byBgY29uZmlnLmV4dHJhYC5cbiAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoaW5wdXQpKSB7XG4gICAgaWYgKCEvXihob3N0fHBvcnR8bWV0aG9kfHBhc3N3b3JkfHRhZykkLy50ZXN0KGtleSkpIHtcbiAgICAgIGNvbmZpZy5leHRyYVtrZXldID0gaW5wdXRba2V5XSAmJiBpbnB1dFtrZXldLnRvU3RyaW5nKCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjb25maWc7XG59XG5cbmV4cG9ydCBjb25zdCBTSEFET1dTT0NLU19VUkkgPSB7XG4gIFBST1RPQ09MOiAnc3M6JyxcblxuICBnZXRVcmlGb3JtYXR0ZWRIb3N0OiAoaG9zdDogSG9zdCkgPT4ge1xuICAgIHJldHVybiBob3N0LmlzSVB2NiA/IGBbJHtob3N0LmRhdGF9XWAgOiBob3N0LmRhdGE7XG4gIH0sXG5cbiAgZ2V0SGFzaDogKHRhZzogVGFnKSA9PiB7XG4gICAgcmV0dXJuIHRhZy5kYXRhID8gYCMke2VuY29kZVVSSUNvbXBvbmVudCh0YWcuZGF0YSl9YCA6ICcnO1xuICB9LFxuXG4gIHZhbGlkYXRlUHJvdG9jb2w6ICh1cmk6IHN0cmluZykgPT4ge1xuICAgIGlmICghdXJpLnN0YXJ0c1dpdGgoU0hBRE9XU09DS1NfVVJJLlBST1RPQ09MKSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVcmkoYFVSSSBtdXN0IHN0YXJ0IHdpdGggXCIke1NIQURPV1NPQ0tTX1VSSS5QUk9UT0NPTH1cIjogJHt1cml9YCk7XG4gICAgfVxuICB9LFxuXG4gIHBhcnNlOiAodXJpOiBzdHJpbmcpOiBDb25maWcgPT4ge1xuICAgIGxldCBlcnJvcjogRXJyb3IgfCB1bmRlZmluZWQ7XG4gICAgZm9yIChjb25zdCB1cmlUeXBlIG9mIFtTSVAwMDJfVVJJLCBMRUdBQ1lfQkFTRTY0X1VSSV0pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB1cmlUeXBlLnBhcnNlKHVyaSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGVycm9yID0gZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBJbnZhbGlkVXJpKSkge1xuICAgICAgY29uc3Qgb3JpZ2luYWxFcnJvck5hbWUgPSBlcnJvciEubmFtZSEgfHwgJyhVbm5hbWVkIEVycm9yKSc7XG4gICAgICBjb25zdCBvcmlnaW5hbEVycm9yTWVzc2FnZSA9IGVycm9yIS5tZXNzYWdlISB8fCAnKG5vIGVycm9yIG1lc3NhZ2UgcHJvdmlkZWQpJztcbiAgICAgIGNvbnN0IG9yaWdpbmFsRXJyb3JTdHJpbmcgPSBgJHtvcmlnaW5hbEVycm9yTmFtZX06ICR7b3JpZ2luYWxFcnJvck1lc3NhZ2V9YDtcbiAgICAgIGNvbnN0IG5ld0Vycm9yTWVzc2FnZSA9IGBJbnZhbGlkIGlucHV0OiAke3VyaX0gLSBPcmlnaW5hbCBlcnJvcjogJHtvcmlnaW5hbEVycm9yU3RyaW5nfWA7XG4gICAgICBlcnJvciA9IG5ldyBJbnZhbGlkVXJpKG5ld0Vycm9yTWVzc2FnZSk7XG4gICAgfVxuICAgIHRocm93IGVycm9yO1xuICB9LFxufTtcblxuLy8gUmVmOiBodHRwczovL3NoYWRvd3NvY2tzLm9yZy9lbi9jb25maWcvcXVpY2stZ3VpZGUuaHRtbFxuZXhwb3J0IGNvbnN0IExFR0FDWV9CQVNFNjRfVVJJID0ge1xuICBwYXJzZTogKHVyaTogc3RyaW5nKTogQ29uZmlnID0+IHtcbiAgICBTSEFET1dTT0NLU19VUkkudmFsaWRhdGVQcm90b2NvbCh1cmkpO1xuICAgIGNvbnN0IGhhc2hJbmRleCA9IHVyaS5pbmRleE9mKCcjJyk7XG4gICAgY29uc3QgaGFzVGFnID0gaGFzaEluZGV4ICE9PSAtMTtcbiAgICBjb25zdCBiNjRFbmRJbmRleCA9IGhhc1RhZyA/IGhhc2hJbmRleCA6IHVyaS5sZW5ndGg7XG4gICAgY29uc3QgdGFnU3RhcnRJbmRleCA9IGhhc1RhZyA/IGhhc2hJbmRleCArIDEgOiB1cmkubGVuZ3RoO1xuICAgIGNvbnN0IHRhZyA9IG5ldyBUYWcoZGVjb2RlVVJJQ29tcG9uZW50KHVyaS5zdWJzdHJpbmcodGFnU3RhcnRJbmRleCkpKTtcbiAgICBjb25zdCBiNjRFbmNvZGVkRGF0YSA9IHVyaS5zdWJzdHJpbmcoJ3NzOi8vJy5sZW5ndGgsIGI2NEVuZEluZGV4KTtcbiAgICBjb25zdCBiNjREZWNvZGVkRGF0YSA9IGI2NERlY29kZShiNjRFbmNvZGVkRGF0YSk7XG4gICAgY29uc3QgYXRTaWduSW5kZXggPSBiNjREZWNvZGVkRGF0YS5pbmRleE9mKCdAJyk7XG4gICAgaWYgKGF0U2lnbkluZGV4ID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVcmkoYE1pc3NpbmcgXCJAXCI6ICR7YjY0RGVjb2RlZERhdGF9YCk7XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZEFuZFBhc3N3b3JkID0gYjY0RGVjb2RlZERhdGEuc3Vic3RyaW5nKDAsIGF0U2lnbkluZGV4KTtcbiAgICBjb25zdCBtZXRob2RFbmRJbmRleCA9IG1ldGhvZEFuZFBhc3N3b3JkLmluZGV4T2YoJzonKTtcbiAgICBpZiAobWV0aG9kRW5kSW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVyaShgTWlzc2luZyBwYXNzd29yZCBwYXJ0OiAke21ldGhvZEFuZFBhc3N3b3JkfWApO1xuICAgIH1cbiAgICBjb25zdCBtZXRob2RTdHJpbmcgPSBtZXRob2RBbmRQYXNzd29yZC5zdWJzdHJpbmcoMCwgbWV0aG9kRW5kSW5kZXgpO1xuICAgIGNvbnN0IG1ldGhvZCA9IG5ldyBNZXRob2QobWV0aG9kU3RyaW5nKTtcbiAgICBjb25zdCBwYXNzd29yZFN0YXJ0SW5kZXggPSBtZXRob2RFbmRJbmRleCArIDE7XG4gICAgY29uc3QgcGFzc3dvcmRTdHJpbmcgPSBtZXRob2RBbmRQYXNzd29yZC5zdWJzdHJpbmcocGFzc3dvcmRTdGFydEluZGV4KTtcbiAgICBjb25zdCBwYXNzd29yZCA9IG5ldyBQYXNzd29yZChwYXNzd29yZFN0cmluZyk7XG4gICAgY29uc3QgaG9zdFN0YXJ0SW5kZXggPSBhdFNpZ25JbmRleCArIDE7XG4gICAgY29uc3QgaG9zdEFuZFBvcnQgPSBiNjREZWNvZGVkRGF0YS5zdWJzdHJpbmcoaG9zdFN0YXJ0SW5kZXgpO1xuICAgIGNvbnN0IGhvc3RFbmRJbmRleCA9IGhvc3RBbmRQb3J0Lmxhc3RJbmRleE9mKCc6Jyk7XG4gICAgaWYgKGhvc3RFbmRJbmRleCA9PT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBJbnZhbGlkVXJpKGBNaXNzaW5nIHBvcnQgcGFydDogJHtob3N0QW5kUG9ydH1gKTtcbiAgICB9XG4gICAgY29uc3QgdXJpRm9ybWF0dGVkSG9zdCA9IGhvc3RBbmRQb3J0LnN1YnN0cmluZygwLCBob3N0RW5kSW5kZXgpO1xuICAgIGxldCBob3N0OiBIb3N0O1xuICAgIHRyeSB7XG4gICAgICBob3N0ID0gbmV3IEhvc3QodXJpRm9ybWF0dGVkSG9zdCk7XG4gICAgfSBjYXRjaCAoXykge1xuICAgICAgLy8gQ291bGQgYmUgSVB2NiBob3N0IGZvcm1hdHRlZCB3aXRoIHN1cnJvdW5kaW5nIGJyYWNrZXRzLCBzbyB0cnkgc3RyaXBwaW5nIGZpcnN0IGFuZCBsYXN0XG4gICAgICAvLyBjaGFyYWN0ZXJzLiBJZiB0aGlzIHRocm93cywgZ2l2ZSB1cCBhbmQgbGV0IHRoZSBleGNlcHRpb24gcHJvcGFnYXRlLlxuICAgICAgaG9zdCA9IG5ldyBIb3N0KHVyaUZvcm1hdHRlZEhvc3Quc3Vic3RyaW5nKDEsIHVyaUZvcm1hdHRlZEhvc3QubGVuZ3RoIC0gMSkpO1xuICAgIH1cbiAgICBjb25zdCBwb3J0U3RhcnRJbmRleCA9IGhvc3RFbmRJbmRleCArIDE7XG4gICAgY29uc3QgcG9ydFN0cmluZyA9IGhvc3RBbmRQb3J0LnN1YnN0cmluZyhwb3J0U3RhcnRJbmRleCk7XG4gICAgY29uc3QgcG9ydCA9IG5ldyBQb3J0KHBvcnRTdHJpbmcpO1xuICAgIGNvbnN0IGV4dHJhID0ge30gYXMge1trZXk6IHN0cmluZ106IHN0cmluZ307ICAvLyBlbXB0eSBiZWNhdXNlIExlZ2FjeUJhc2U2NFVyaSBjYW4ndCBob2xkIGV4dHJhXG4gICAgcmV0dXJuIHttZXRob2QsIHBhc3N3b3JkLCBob3N0LCBwb3J0LCB0YWcsIGV4dHJhfTtcbiAgfSxcblxuICBzdHJpbmdpZnk6IChjb25maWc6IENvbmZpZykgPT4ge1xuICAgIGNvbnN0IHtob3N0LCBwb3J0LCBtZXRob2QsIHBhc3N3b3JkLCB0YWd9ID0gY29uZmlnO1xuICAgIGNvbnN0IGhhc2ggPSBTSEFET1dTT0NLU19VUkkuZ2V0SGFzaCh0YWcpO1xuICAgIGxldCBiNjRFbmNvZGVkRGF0YSA9IGI2NEVuY29kZShgJHttZXRob2QuZGF0YX06JHtwYXNzd29yZC5kYXRhfUAke2hvc3QuZGF0YX06JHtwb3J0LmRhdGF9YCk7XG4gICAgY29uc3QgZGF0YUxlbmd0aCA9IGI2NEVuY29kZWREYXRhLmxlbmd0aDtcbiAgICBsZXQgcGFkZGluZ0xlbmd0aCA9IDA7XG4gICAgZm9yICg7IGI2NEVuY29kZWREYXRhW2RhdGFMZW5ndGggLSAxIC0gcGFkZGluZ0xlbmd0aF0gPT09ICc9JzsgcGFkZGluZ0xlbmd0aCsrKTtcbiAgICBiNjRFbmNvZGVkRGF0YSA9IHBhZGRpbmdMZW5ndGggPT09IDAgPyBiNjRFbmNvZGVkRGF0YSA6XG4gICAgICAgIGI2NEVuY29kZWREYXRhLnN1YnN0cmluZygwLCBkYXRhTGVuZ3RoIC0gcGFkZGluZ0xlbmd0aCk7XG4gICAgcmV0dXJuIGBzczovLyR7YjY0RW5jb2RlZERhdGF9JHtoYXNofWA7XG4gIH0sXG59O1xuXG4vLyBSZWY6IGh0dHBzOi8vc2hhZG93c29ja3Mub3JnL2VuL3NwZWMvU0lQMDAyLVVSSS1TY2hlbWUuaHRtbFxuZXhwb3J0IGNvbnN0IFNJUDAwMl9VUkkgPSB7XG4gIHBhcnNlOiAodXJpOiBzdHJpbmcpOiBDb25maWcgPT4ge1xuICAgIFNIQURPV1NPQ0tTX1VSSS52YWxpZGF0ZVByb3RvY29sKHVyaSk7XG4gICAgLy8gQ2FuIHVzZSBidWlsdC1pbiBVUkwgcGFyc2VyIGZvciBleHBlZGllbmNlLiBKdXN0IGhhdmUgdG8gcmVwbGFjZSBcInNzXCIgd2l0aCBcImh0dHBcIiB0byBlbnN1cmVcbiAgICAvLyBjb3JyZWN0IHJlc3VsdHMuXG4gICAgY29uc3QgaW5wdXRGb3JVcmxQYXJzZXIgPSBgaHR0cCR7dXJpLnN1YnN0cmluZygyKX1gO1xuICAgIC8vIFRoZSBidWlsdC1pbiBVUkwgcGFyc2VyIHRocm93cyBhcyBkZXNpcmVkIHdoZW4gZ2l2ZW4gVVJJcyB3aXRoIGludmFsaWQgc3ludGF4LlxuICAgIGNvbnN0IHVybFBhcnNlclJlc3VsdCA9IG5ldyBVUkwoaW5wdXRGb3JVcmxQYXJzZXIpO1xuICAgIGNvbnN0IHVyaUZvcm1hdHRlZEhvc3QgPSB1cmxQYXJzZXJSZXN1bHQuaG9zdG5hbWU7XG4gICAgLy8gVVJJLWZvcm1hdHRlZCBJUHY2IGhvc3RuYW1lcyBoYXZlIHN1cnJvdW5kaW5nIGJyYWNrZXRzLlxuICAgIGNvbnN0IGxhc3QgPSB1cmlGb3JtYXR0ZWRIb3N0Lmxlbmd0aCAtIDE7XG4gICAgY29uc3QgYnJhY2tldHMgPSB1cmlGb3JtYXR0ZWRIb3N0WzBdID09PSAnWycgJiYgdXJpRm9ybWF0dGVkSG9zdFtsYXN0XSA9PT0gJ10nO1xuICAgIGNvbnN0IGhvc3RTdHJpbmcgPSBicmFja2V0cyA/IHVyaUZvcm1hdHRlZEhvc3Quc3Vic3RyaW5nKDEsIGxhc3QpIDogdXJpRm9ybWF0dGVkSG9zdDtcbiAgICBjb25zdCBob3N0ID0gbmV3IEhvc3QoaG9zdFN0cmluZyk7XG4gICAgY29uc3QgcG9ydCA9IG5ldyBQb3J0KHVybFBhcnNlclJlc3VsdC5wb3J0KTtcbiAgICBjb25zdCB0YWcgPSBuZXcgVGFnKGRlY29kZVVSSUNvbXBvbmVudCh1cmxQYXJzZXJSZXN1bHQuaGFzaC5zdWJzdHJpbmcoMSkpKTtcbiAgICBjb25zdCBiNjRFbmNvZGVkVXNlckluZm8gPSB1cmxQYXJzZXJSZXN1bHQudXNlcm5hbWUucmVwbGFjZSgvJTNEL2csICc9Jyk7XG4gICAgLy8gYmFzZTY0LmRlY29kZSB0aHJvd3MgYXMgZGVzaXJlZCB3aGVuIGdpdmVuIGludmFsaWQgYmFzZTY0IGlucHV0LlxuICAgIGNvbnN0IGI2NERlY29kZWRVc2VySW5mbyA9IGI2NERlY29kZShiNjRFbmNvZGVkVXNlckluZm8pO1xuICAgIGNvbnN0IGNvbG9uSWR4ID0gYjY0RGVjb2RlZFVzZXJJbmZvLmluZGV4T2YoJzonKTtcbiAgICBpZiAoY29sb25JZHggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVyaShgTWlzc2luZyBwYXNzd29yZCBwYXJ0OiAke2I2NERlY29kZWRVc2VySW5mb31gKTtcbiAgICB9XG4gICAgY29uc3QgbWV0aG9kU3RyaW5nID0gYjY0RGVjb2RlZFVzZXJJbmZvLnN1YnN0cmluZygwLCBjb2xvbklkeCk7XG4gICAgY29uc3QgbWV0aG9kID0gbmV3IE1ldGhvZChtZXRob2RTdHJpbmcpO1xuICAgIGNvbnN0IHBhc3N3b3JkU3RyaW5nID0gYjY0RGVjb2RlZFVzZXJJbmZvLnN1YnN0cmluZyhjb2xvbklkeCArIDEpO1xuICAgIGNvbnN0IHBhc3N3b3JkID0gbmV3IFBhc3N3b3JkKHBhc3N3b3JkU3RyaW5nKTtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHVybFBhcnNlclJlc3VsdC5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XG4gICAgY29uc3QgZXh0cmEgPSB7fSBhcyB7W2tleTogc3RyaW5nXTogc3RyaW5nfTtcbiAgICBmb3IgKGNvbnN0IHBhaXIgb2YgcXVlcnlQYXJhbXMpIHtcbiAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IHBhaXIuc3BsaXQoJz0nLCAyKTtcbiAgICAgIGlmICgha2V5KSBjb250aW51ZTtcbiAgICAgIGV4dHJhW2tleV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUgfHwgJycpO1xuICAgIH1cbiAgICByZXR1cm4ge21ldGhvZCwgcGFzc3dvcmQsIGhvc3QsIHBvcnQsIHRhZywgZXh0cmF9O1xuICB9LFxuXG4gIHN0cmluZ2lmeTogKGNvbmZpZzogQ29uZmlnKSA9PiB7XG4gICAgY29uc3Qge2hvc3QsIHBvcnQsIG1ldGhvZCwgcGFzc3dvcmQsIHRhZywgZXh0cmF9ID0gY29uZmlnO1xuICAgIGNvbnN0IHVzZXJJbmZvID0gYjY0RW5jb2RlKGAke21ldGhvZC5kYXRhfToke3Bhc3N3b3JkLmRhdGF9YCk7XG4gICAgY29uc3QgdXJpSG9zdCA9IFNIQURPV1NPQ0tTX1VSSS5nZXRVcmlGb3JtYXR0ZWRIb3N0KGhvc3QpO1xuICAgIGNvbnN0IGhhc2ggPSBTSEFET1dTT0NLU19VUkkuZ2V0SGFzaCh0YWcpO1xuICAgIGxldCBxdWVyeVN0cmluZyA9ICcnO1xuICAgIGZvciAoY29uc3Qga2V5IGluIGV4dHJhKSB7XG4gICAgICBpZiAoIWtleSkgY29udGludWU7XG4gICAgICBxdWVyeVN0cmluZyArPSAocXVlcnlTdHJpbmcgPyAnJicgOiAnPycpICsgYCR7a2V5fT0ke2VuY29kZVVSSUNvbXBvbmVudChleHRyYVtrZXldKX1gO1xuICAgIH1cbiAgICByZXR1cm4gYHNzOi8vJHt1c2VySW5mb31AJHt1cmlIb3N0fToke3BvcnQuZGF0YX0vJHtxdWVyeVN0cmluZ30ke2hhc2h9YDtcbiAgfSxcbn07XG4iXX0=
