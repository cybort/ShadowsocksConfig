"use strict";
(function iife() {
  const platformExportObj = (function detectPlatformExportObj() {
    if (typeof module !== 'undefined' && module.exports) {
      return module.exports;  // node
    } else if (typeof window !== 'undefined') {
      return window;  // browser
    }
    throw new Error('Could not detect platform global object (no window or module.exports)');
  })();
const isBrowser = typeof window !== 'undefined';
const b64Encode = isBrowser ? btoa : require('base-64').encode;
const b64Decode = isBrowser ? atob : require('base-64').decode;
const URL = isBrowser ? window.URL : require('url').URL;
class ShadowsocksConfigError extends Error {
    constructor(message) {
        super(message);
        Object.setPrototypeOf(this, new.target.prototype);
        this.name = new.target.name;
    }
}
platformExportObj.ShadowsocksConfigError = ShadowsocksConfigError;
class InvalidConfigField extends ShadowsocksConfigError {
    constructor(message) {
        super(message);
        this.message = message;
    }
}
platformExportObj.InvalidConfigField = InvalidConfigField;
class InvalidURI extends ShadowsocksConfigError {
    constructor(message) {
        super(message);
        this.message = message;
    }
}
platformExportObj.InvalidURI = InvalidURI;
class ConfigField {
    constructor(data) {
        this.data = data;
    }
    toString() {
        return this.data.toString();
    }
}
platformExportObj.ConfigField = ConfigField;
function throwErrorForInvalidField(name, value) {
    throw new InvalidConfigField(`Invalid ${name}: ${value}`);
}
class Host extends ConfigField {
    constructor(host) {
        if (host instanceof Host) {
            host = host.data;
        }
        try {
            const urlParserResult = new URL(`http://${host}/`);
            super(urlParserResult.hostname);
        }
        catch (_) {
            throwErrorForInvalidField('host', host);
        }
    }
}
platformExportObj.Host = Host;
class Port extends ConfigField {
    constructor(port) {
        if (port instanceof Port) {
            port = port.data;
        }
        const throwError = () => throwErrorForInvalidField('port', port);
        if (port === '')
            throwError();
        try {
            const urlParserResult = new URL(`http://0.0.0.0:${port}/`);
            super(urlParserResult.port);
        }
        catch (_) {
            throwError();
        }
    }
}
platformExportObj.Port = Port;
class Method extends ConfigField {
    constructor(method) {
        if (method instanceof Method) {
            method = method.data;
        }
        super(method);
        if (!Method.METHODS.has(method)) {
            throwErrorForInvalidField('method', method);
        }
    }
}
Method.METHODS = new Set([
    'rc4-md5',
    'aes-128-gcm',
    'aes-192-gcm',
    'aes-256-gcm',
    'aes-128-cfb',
    'aes-192-cfb',
    'aes-256-cfb',
    'aes-128-ctr',
    'aes-192-ctr',
    'aes-256-ctr',
    'camellia-128-cfb',
    'camellia-192-cfb',
    'camellia-256-cfb',
    'bf-cfb',
    'chacha20-ietf-poly1305',
    'salsa20',
    'chacha20',
    'chacha20-ietf',
]);
platformExportObj.Method = Method;
class Password extends ConfigField {
    constructor(password) {
        super((password instanceof Password ? password.data : password) || '');
    }
}
platformExportObj.Password = Password;
class Tag extends ConfigField {
    constructor(tag) {
        super((tag instanceof Tag ? tag.data : tag) || '');
    }
}
platformExportObj.Tag = Tag;
class Plugin extends ConfigField {
    constructor(plugin) {
        super((plugin instanceof Plugin ? plugin.data : plugin) || '');
    }
}
platformExportObj.Plugin = Plugin;
class Config {
    constructor(config) {
        this.host = config.host;
        this.port = config.port;
        this.method = config.method;
        this.password = config.password;
        this.tag = config.tag;
    }
    set host(host) {
        this.host_ = new Host(host);
    }
    set port(port) {
        this.port_ = new Port(port);
    }
    set method(method) {
        this.method_ = new Method(method);
    }
    set password(password) {
        this.password_ = new Password(password);
    }
    set tag(tag) {
        this.tag_ = new Tag(tag);
    }
    get host() {
        return this.host_.toString();
    }
    get port() {
        return this.port_.toString();
    }
    get method() {
        return this.method_.toString();
    }
    get password() {
        return this.password_.toString();
    }
    get tag() {
        return this.tag_.toString();
    }
}
platformExportObj.Config = Config;
class ShadowsocksURI extends Config {
    constructor(config) {
        super(new Config(config));
    }
    static validateProtocol(uri) {
        if (!uri.startsWith('ss://')) {
            throw new InvalidURI(`URI must start with "ss://": ${uri}`);
        }
    }
    static getHash(config) {
        const tag = config.tag instanceof Tag ? config.tag.data : config.tag;
        return tag ? `#${encodeURIComponent(tag)}` : '';
    }
    static parse(uri) {
        let error;
        for (const UriType of [LegacyBase64URI, Sip002URI]) {
            try {
                return UriType.parse(uri);
            }
            catch (e) {
                error = error || e;
            }
        }
        if (!(error instanceof InvalidURI)) {
            const originalErrorName = error.name || '(Unnamed Error)';
            const originalErrorMessage = error.message || '(no error message provided)';
            const originalErrorString = `${originalErrorName}: ${originalErrorMessage}`;
            const newErrorMessage = `Invalid input: ${uri} - Original error: ${originalErrorString}`;
            error = new InvalidURI(newErrorMessage);
        }
        throw error;
    }
}
platformExportObj.ShadowsocksURI = ShadowsocksURI;
class LegacyBase64URI extends ShadowsocksURI {
    constructor(config) {
        super(new Config(config));
        const { method, password, host, port } = this;
        const b64EncodedData = b64Encode(`${method}:${password}@${host}:${port}`);
        const dataLength = b64EncodedData.length;
        let paddingLength = 0;
        for (; b64EncodedData[dataLength - 1 - paddingLength] === '='; paddingLength++)
            ;
        this.b64EncodedData = paddingLength === 0 ? b64EncodedData :
            b64EncodedData.substring(0, dataLength - paddingLength);
    }
    static parse(uri) {
        ShadowsocksURI.validateProtocol(uri);
        const hashIndex = uri.indexOf('#');
        let b64EndIndex = hashIndex;
        let tagStartIndex = hashIndex + 1;
        if (hashIndex === -1) {
            b64EndIndex = tagStartIndex = uri.length;
        }
        const tag = new Tag(decodeURIComponent(uri.substring(tagStartIndex)));
        const b64EncodedData = uri.substring('ss://'.length, b64EndIndex);
        const b64DecodedData = b64Decode(b64EncodedData);
        const atSignIndex = b64DecodedData.indexOf('@');
        if (atSignIndex === -1) {
            throw new InvalidURI(`Missing "@": ${b64DecodedData}`);
        }
        const methodAndPassword = b64DecodedData.substring(0, atSignIndex);
        const methodEndIndex = methodAndPassword.indexOf(':');
        if (methodEndIndex === -1) {
            throw new InvalidURI(`Missing password part: ${methodAndPassword}`);
        }
        const methodString = methodAndPassword.substring(0, methodEndIndex);
        const method = new Method(methodString);
        const passwordStartIndex = methodEndIndex + 1;
        const passwordString = methodAndPassword.substring(passwordStartIndex);
        const password = new Password(passwordString);
        const hostStartIndex = atSignIndex + 1;
        const hostAndPort = b64DecodedData.substring(hostStartIndex);
        const hostEndIndex = hostAndPort.indexOf(':');
        if (hostEndIndex === -1) {
            throw new InvalidURI(`Missing port part: ${hostAndPort}`);
        }
        const host = new Host(hostAndPort.substring(0, hostEndIndex));
        const portStartIndex = hostEndIndex + 1;
        const portString = hostAndPort.substring(portStartIndex);
        const port = new Port(portString);
        return new LegacyBase64URI({ method, password, host, port, tag });
    }
    toString() {
        const { b64EncodedData, tag } = this;
        const hash = ShadowsocksURI.getHash(this);
        return `ss://${b64EncodedData}${hash}`;
    }
}
platformExportObj.LegacyBase64URI = LegacyBase64URI;
class Sip002URI extends ShadowsocksURI {
    constructor(config) {
        super(new Config(config));
        const { method, password } = this;
        this.b64EncodedUserInfo = b64Encode(`${method}:${password}`);
        this.plugin = config.plugin;
    }
    set plugin(plugin) {
        this.plugin_ = new Plugin(plugin);
    }
    get plugin() {
        return this.plugin_.toString();
    }
    static parse(uri) {
        ShadowsocksURI.validateProtocol(uri);
        const inputForUrlParser = `http${uri.substring(2)}`;
        const urlParserResult = new URL(inputForUrlParser);
        const host = new Host(urlParserResult.hostname);
        const port = new Port(urlParserResult.port);
        const tag = new Tag(decodeURIComponent(urlParserResult.hash.substring(1)));
        const b64EncodedUserInfo = urlParserResult.username.replace(/%3D/g, '=');
        const b64DecodedUserInfo = b64Decode(b64EncodedUserInfo);
        const colonIdx = b64DecodedUserInfo.indexOf(':');
        if (colonIdx === -1) {
            throw new InvalidURI(`Missing password part: ${b64DecodedUserInfo}`);
        }
        const methodString = b64DecodedUserInfo.substring(0, colonIdx);
        const method = new Method(methodString);
        const passwordString = b64DecodedUserInfo.substring(colonIdx + 1);
        const password = new Password(passwordString);
        let plugin;
        if (urlParserResult.searchParams) {
            const pluginString = urlParserResult.searchParams.get('plugin');
            plugin = pluginString ? new Plugin(pluginString) : undefined;
        }
        return new Sip002URI({ method, password, host, port, tag, plugin });
    }
    toString() {
        const { b64EncodedUserInfo, host, port, plugin, tag } = this;
        const queryString = plugin ? `?plugin=${plugin}` : '';
        const hash = ShadowsocksURI.getHash(this);
        return `ss://${b64EncodedUserInfo}@${host}:${port}/${queryString}${hash}`;
    }
}
platformExportObj.Sip002URI = Sip002URI;
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,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TUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxXQUFXLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDdEQsTUFBTSxJQUFJLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQyxNQUFNLENBQUMsUUFBUSxrQkFBa0IsSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLFdBQVcsR0FBRyxJQUFJLEVBQUUsQ0FBQztJQUM1RSxDQUFDO0NBQ0Y7QUFyREQsOEJBcURDIiwiZmlsZSI6InNoYWRvd3NvY2tzX2NvbmZpZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHR5cGVzPVwibm9kZVwiIC8+XG5cbmNvbnN0IGlzQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnO1xuY29uc3QgYjY0RW5jb2RlID0gaXNCcm93c2VyID8gYnRvYSA6IHJlcXVpcmUoJ2Jhc2UtNjQnKS5lbmNvZGU7XG5jb25zdCBiNjREZWNvZGUgPSBpc0Jyb3dzZXIgPyBhdG9iIDogcmVxdWlyZSgnYmFzZS02NCcpLmRlY29kZTtcbmNvbnN0IFVSTCA9IGlzQnJvd3NlciA/IHdpbmRvdy5VUkwgOiByZXF1aXJlKCd1cmwnKS5VUkw7XG5cbi8vIEN1c3RvbSBlcnJvciBiYXNlIGNsYXNzXG5leHBvcnQgY2xhc3MgU2hhZG93c29ja3NDb25maWdFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7ICAvLyAnRXJyb3InIGJyZWFrcyBwcm90b3R5cGUgY2hhaW4gaGVyZSBpZiB0aGlzIGlzIHRyYW5zcGlsZWQgdG8gZXM1XG4gICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIG5ldy50YXJnZXQucHJvdG90eXBlKTsgIC8vIHJlc3RvcmUgcHJvdG90eXBlIGNoYWluXG4gICAgdGhpcy5uYW1lID0gbmV3LnRhcmdldC5uYW1lO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnZhbGlkQ29uZmlnRmllbGQgZXh0ZW5kcyBTaGFkb3dzb2Nrc0NvbmZpZ0Vycm9yIHtcbiAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IG1lc3NhZ2U6IHN0cmluZykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnZhbGlkVVJJIGV4dGVuZHMgU2hhZG93c29ja3NDb25maWdFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyByZWFkb25seSBtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgfVxufVxuLy8gRW5kIGN1c3RvbSBlcnJvcnNcblxuLy8gU2VsZi12YWxpZGF0aW5nL25vcm1hbGl6aW5nIGNvbmZpZyBkYXRhIHR5cGVzIHN1YmNsYXNzIHRoaXMgQ29uZmlnRmllbGQgY2xhc3MuXG4vLyBDb25zdHJ1Y3RvcnMgdGFrZSBhIHN0cmluZywgdmFsaWRhdGUvbm9ybWFsaXplL2FjY2VwdCBpZiB2YWxpZCwgb3IgdGhyb3cgb3RoZXJ3aXNlLlxuLy8gU29tZSBleGFtcGxlcyAoUG9ydCBpcyBhIENvbmZpZ0ZpZWxkIHN1YmNsYXNzLCBzZWUgYmVsb3cpOlxuLy8gICBuZXcgUG9ydCgnJykgICAgICAgICAgIC0+IHRocm93c1xuLy8gICBuZXcgUG9ydCgnbm90IGEgcG9ydCcpIC0+IHRocm93c1xuLy8gICBuZXcgUG9ydCgnLTEyMycpICAgICAgIC0+IHRocm93c1xuLy8gICBuZXcgUG9ydCgnMTIzLjQnKSAgICAgIC0+IHRocm93c1xuLy8gICBuZXcgUG9ydCgnMDEyMzQnKSAgICAgIC0+ICcxMjM0J1xuZXhwb3J0IGNsYXNzIENvbmZpZ0ZpZWxkIHtcbiAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IGRhdGE6IHN0cmluZykge31cblxuICB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLnRvU3RyaW5nKCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gdGhyb3dFcnJvckZvckludmFsaWRGaWVsZChuYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgdGhyb3cgbmV3IEludmFsaWRDb25maWdGaWVsZChgSW52YWxpZCAke25hbWV9OiAke3ZhbHVlfWApO1xufVxuXG5leHBvcnQgY2xhc3MgSG9zdCBleHRlbmRzIENvbmZpZ0ZpZWxkIHtcbiAgY29uc3RydWN0b3IoaG9zdDogSG9zdCB8IHN0cmluZykge1xuICAgIGlmIChob3N0IGluc3RhbmNlb2YgSG9zdCkge1xuICAgICAgaG9zdCA9IGhvc3QuZGF0YTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIC8vIFRPRE86IHVzZSBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9pcC1hZGRyZXNzIHRvIHJlc3RyaWN0IHRvIG9ubHkgSVAgYWRkcmVzc2VzXG4gICAgICBjb25zdCB1cmxQYXJzZXJSZXN1bHQgPSBuZXcgVVJMKGBodHRwOi8vJHtob3N0fS9gKTtcbiAgICAgIHN1cGVyKHVybFBhcnNlclJlc3VsdC5ob3N0bmFtZSk7XG4gICAgfSBjYXRjaCAoXykge1xuICAgICAgdGhyb3dFcnJvckZvckludmFsaWRGaWVsZCgnaG9zdCcsIGhvc3QpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBQb3J0IHZhbGlkYXRpb24vbm9ybWFsaXphdGlvbiBpcyBidWlsdCBvbiB0b3Agb2YgVVJMIGZvciBzYWZldHkgYW5kIGVmZmljaWVuY3kuXG4vLyBOT1RFOiBQb3J0IGRhdGEgaXMgc3RvcmVkIGFzIGEgc3RyaW5nLCBub3QgYSBudW1iZXIsIGFzIGluIGEgVVJMIGluc3RhbmNlLlxuZXhwb3J0IGNsYXNzIFBvcnQgZXh0ZW5kcyBDb25maWdGaWVsZCB7XG4gIGNvbnN0cnVjdG9yKHBvcnQ6IFBvcnQgfCBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICBpZiAocG9ydCBpbnN0YW5jZW9mIFBvcnQpIHtcbiAgICAgIHBvcnQgPSBwb3J0LmRhdGE7XG4gICAgfVxuICAgIGNvbnN0IHRocm93RXJyb3IgPSAoKSA9PiB0aHJvd0Vycm9yRm9ySW52YWxpZEZpZWxkKCdwb3J0JywgcG9ydCk7XG4gICAgaWYgKHBvcnQgPT09ICcnKSB0aHJvd0Vycm9yKCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVybFBhcnNlclJlc3VsdCA9IG5ldyBVUkwoYGh0dHA6Ly8wLjAuMC4wOiR7cG9ydH0vYCk7XG4gICAgICBzdXBlcih1cmxQYXJzZXJSZXN1bHQucG9ydCk7XG4gICAgfSBjYXRjaCAoXykge1xuICAgICAgdGhyb3dFcnJvcigpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBBIG1ldGhvZCB2YWx1ZSBtdXN0IGV4YWN0bHkgbWF0Y2ggYW4gZWxlbWVudCBpbiB0aGUgc2V0IG9mIGtub3duIGNpcGhlcnMuXG4vLyByZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9zaGFkb3dzb2Nrcy9zaGFkb3dzb2Nrcy1saWJldi9ibG9iLzEwYTJkM2UzL2NvbXBsZXRpb25zL2Jhc2gvc3MtcmVkaXIjTDVcbmV4cG9ydCBjbGFzcyBNZXRob2QgZXh0ZW5kcyBDb25maWdGaWVsZCB7XG4gIHByaXZhdGUgc3RhdGljIE1FVEhPRFMgPSBuZXcgU2V0KFtcbiAgICAncmM0LW1kNScsXG4gICAgJ2Flcy0xMjgtZ2NtJyxcbiAgICAnYWVzLTE5Mi1nY20nLFxuICAgICdhZXMtMjU2LWdjbScsXG4gICAgJ2Flcy0xMjgtY2ZiJyxcbiAgICAnYWVzLTE5Mi1jZmInLFxuICAgICdhZXMtMjU2LWNmYicsXG4gICAgJ2Flcy0xMjgtY3RyJyxcbiAgICAnYWVzLTE5Mi1jdHInLFxuICAgICdhZXMtMjU2LWN0cicsXG4gICAgJ2NhbWVsbGlhLTEyOC1jZmInLFxuICAgICdjYW1lbGxpYS0xOTItY2ZiJyxcbiAgICAnY2FtZWxsaWEtMjU2LWNmYicsXG4gICAgJ2JmLWNmYicsXG4gICAgJ2NoYWNoYTIwLWlldGYtcG9seTEzMDUnLFxuICAgICdzYWxzYTIwJyxcbiAgICAnY2hhY2hhMjAnLFxuICAgICdjaGFjaGEyMC1pZXRmJyxcbiAgIF0pO1xuXG4gIGNvbnN0cnVjdG9yKG1ldGhvZDogTWV0aG9kIHwgc3RyaW5nKSB7XG4gICAgaWYgKG1ldGhvZCBpbnN0YW5jZW9mIE1ldGhvZCkge1xuICAgICAgbWV0aG9kID0gbWV0aG9kLmRhdGE7XG4gICAgfVxuICAgIHN1cGVyKG1ldGhvZCk7XG4gICAgaWYgKCFNZXRob2QuTUVUSE9EUy5oYXMobWV0aG9kKSkge1xuICAgICAgdGhyb3dFcnJvckZvckludmFsaWRGaWVsZCgnbWV0aG9kJywgbWV0aG9kKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gQ3VycmVudGx5IG5vIHZhbGlkYXRpb24gaXMgcGVyZm9ybWVkIGZvciBQYXNzd29yZCwgVGFnLCBvciBQbHVnaW4uXG4vLyBDbGllbnQgY29kZSBpcyByZXNwb25zaWJsZSBmb3IgdmFsaWRhdGluZyBhbmQgc2FuaXRpemluZyB0aGVzZSB3aGVuIHVzaW5nIHdpdGggdW50cnVzdGVkIGlucHV0LlxuLy8gVE9ETzogRG9jdW1lbnQgdGhpcyBpbiB0aGUgUkVBRE1FLlxuZXhwb3J0IGNsYXNzIFBhc3N3b3JkIGV4dGVuZHMgQ29uZmlnRmllbGQge1xuICBjb25zdHJ1Y3RvcihwYXNzd29yZD86IFBhc3N3b3JkIHwgc3RyaW5nKSB7XG4gICAgc3VwZXIoKHBhc3N3b3JkIGluc3RhbmNlb2YgUGFzc3dvcmQgPyBwYXNzd29yZC5kYXRhIDogcGFzc3dvcmQpIHx8ICcnKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVGFnIGV4dGVuZHMgQ29uZmlnRmllbGQge1xuICBjb25zdHJ1Y3Rvcih0YWc/OiBUYWcgfCBzdHJpbmcpIHtcbiAgICBzdXBlcigodGFnIGluc3RhbmNlb2YgVGFnID8gdGFnLmRhdGEgOiB0YWcpIHx8ICcnKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGx1Z2luIGV4dGVuZHMgQ29uZmlnRmllbGQge1xuICBjb25zdHJ1Y3RvcihwbHVnaW4/OiBQbHVnaW4gfCBzdHJpbmcpIHtcbiAgICBzdXBlcigocGx1Z2luIGluc3RhbmNlb2YgUGx1Z2luID8gcGx1Z2luLmRhdGEgOiBwbHVnaW4pIHx8ICcnKTtcbiAgfVxufVxuLy8gRW5kIENvbmZpZ0ZpZWxkIHR5cGVzLlxuXG5leHBvcnQgaW50ZXJmYWNlIFVuc2FmZUNvbmZpZyB7XG4gIGhvc3Q/OiBIb3N0IHwgc3RyaW5nO1xuICBwb3J0PzogUG9ydCB8IHN0cmluZyB8IG51bWJlcjtcbiAgbWV0aG9kPzogTWV0aG9kIHwgc3RyaW5nO1xuICBwYXNzd29yZD86IFBhc3N3b3JkIHwgc3RyaW5nO1xuICB0YWc/OiBUYWcgfCBzdHJpbmc7XG4gIHBsdWdpbj86IFBsdWdpbiB8IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpZyBpbXBsZW1lbnRzIFVuc2FmZUNvbmZpZyB7XG4gIHByaXZhdGUgaG9zdF86IEhvc3Q7XG4gIHByaXZhdGUgcG9ydF86IFBvcnQ7XG4gIHByaXZhdGUgbWV0aG9kXzogTWV0aG9kO1xuICBwcml2YXRlIHBhc3N3b3JkXzogUGFzc3dvcmQ7XG4gIHByaXZhdGUgdGFnXzogVGFnO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogVW5zYWZlQ29uZmlnKSB7XG4gICAgdGhpcy5ob3N0ID0gY29uZmlnLmhvc3Q7XG4gICAgdGhpcy5wb3J0ID0gY29uZmlnLnBvcnQ7XG4gICAgdGhpcy5tZXRob2QgPSBjb25maWcubWV0aG9kO1xuICAgIHRoaXMucGFzc3dvcmQgPSBjb25maWcucGFzc3dvcmQ7XG4gICAgdGhpcy50YWcgPSBjb25maWcudGFnO1xuICB9XG5cbiAgc2V0IGhvc3QoaG9zdDogSG9zdCB8IHN0cmluZykge1xuICAgIHRoaXMuaG9zdF8gPSBuZXcgSG9zdChob3N0KTtcbiAgfVxuXG4gIHNldCBwb3J0KHBvcnQ6IFBvcnQgfCBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICB0aGlzLnBvcnRfID0gbmV3IFBvcnQocG9ydCk7XG4gIH1cblxuICBzZXQgbWV0aG9kKG1ldGhvZDogTWV0aG9kIHwgc3RyaW5nKSB7XG4gICAgdGhpcy5tZXRob2RfID0gbmV3IE1ldGhvZChtZXRob2QpO1xuICB9XG5cbiAgc2V0IHBhc3N3b3JkKHBhc3N3b3JkOiBQYXNzd29yZCB8IHN0cmluZykge1xuICAgIHRoaXMucGFzc3dvcmRfID0gbmV3IFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgfVxuXG4gIHNldCB0YWcodGFnOiBUYWcgfCBzdHJpbmcpIHtcbiAgICB0aGlzLnRhZ18gPSBuZXcgVGFnKHRhZyk7XG4gIH1cblxuICBnZXQgaG9zdCgpIHtcbiAgICByZXR1cm4gdGhpcy5ob3N0Xy50b1N0cmluZygpO1xuICB9XG5cbiAgZ2V0IHBvcnQoKSB7XG4gICAgcmV0dXJuIHRoaXMucG9ydF8udG9TdHJpbmcoKTtcbiAgfVxuXG4gIGdldCBtZXRob2QoKSB7XG4gICAgcmV0dXJuIHRoaXMubWV0aG9kXy50b1N0cmluZygpO1xuICB9XG5cbiAgZ2V0IHBhc3N3b3JkKCkge1xuICAgIHJldHVybiB0aGlzLnBhc3N3b3JkXy50b1N0cmluZygpO1xuICB9XG5cbiAgZ2V0IHRhZygpIHtcbiAgICByZXR1cm4gdGhpcy50YWdfLnRvU3RyaW5nKCk7XG4gIH1cbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFNoYWRvd3NvY2tzVVJJIGV4dGVuZHMgQ29uZmlnIHtcbiAgY29uc3RydWN0b3IoY29uZmlnOiBVbnNhZmVDb25maWcpIHtcbiAgICBzdXBlcihuZXcgQ29uZmlnKGNvbmZpZykpO1xuICB9XG5cbiAgYWJzdHJhY3QgdG9TdHJpbmcoKTogc3RyaW5nO1xuXG4gIHN0YXRpYyB2YWxpZGF0ZVByb3RvY29sKHVyaTogc3RyaW5nKSB7XG4gICAgaWYgKCF1cmkuc3RhcnRzV2l0aCgnc3M6Ly8nKSkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRVUkkoYFVSSSBtdXN0IHN0YXJ0IHdpdGggXCJzczovL1wiOiAke3VyaX1gKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZ2V0SGFzaChjb25maWc6IFVuc2FmZUNvbmZpZykge1xuICAgIGNvbnN0IHRhZyA9IGNvbmZpZy50YWcgaW5zdGFuY2VvZiBUYWcgPyBjb25maWcudGFnLmRhdGEgOiBjb25maWcudGFnO1xuICAgIHJldHVybiB0YWcgPyBgIyR7ZW5jb2RlVVJJQ29tcG9uZW50KHRhZyl9YCA6ICcnO1xuICB9XG5cbiAgc3RhdGljIHBhcnNlKHVyaTogc3RyaW5nKTogVW5zYWZlQ29uZmlnIHtcbiAgICBsZXQgZXJyb3I6IEVycm9yO1xuICAgIGZvciAoY29uc3QgVXJpVHlwZSBvZiBbTGVnYWN5QmFzZTY0VVJJLCBTaXAwMDJVUkldKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gVXJpVHlwZS5wYXJzZSh1cmkpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBlcnJvciA9IGVycm9yIHx8IGU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgSW52YWxpZFVSSSkpIHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsRXJyb3JOYW1lID0gKGVycm9yIGFzIEVycm9yKS5uYW1lIHx8ICcoVW5uYW1lZCBFcnJvciknO1xuICAgICAgY29uc3Qgb3JpZ2luYWxFcnJvck1lc3NhZ2UgPSAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2UgfHwgJyhubyBlcnJvciBtZXNzYWdlIHByb3ZpZGVkKSc7XG4gICAgICBjb25zdCBvcmlnaW5hbEVycm9yU3RyaW5nID0gYCR7b3JpZ2luYWxFcnJvck5hbWV9OiAke29yaWdpbmFsRXJyb3JNZXNzYWdlfWA7XG4gICAgICBjb25zdCBuZXdFcnJvck1lc3NhZ2UgPSBgSW52YWxpZCBpbnB1dDogJHt1cml9IC0gT3JpZ2luYWwgZXJyb3I6ICR7b3JpZ2luYWxFcnJvclN0cmluZ31gO1xuICAgICAgZXJyb3IgPSBuZXcgSW52YWxpZFVSSShuZXdFcnJvck1lc3NhZ2UpO1xuICAgIH1cbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBSZWY6IGh0dHBzOi8vc2hhZG93c29ja3Mub3JnL2VuL2NvbmZpZy9xdWljay1ndWlkZS5odG1sXG5leHBvcnQgY2xhc3MgTGVnYWN5QmFzZTY0VVJJIGV4dGVuZHMgU2hhZG93c29ja3NVUkkge1xuICBiNjRFbmNvZGVkRGF0YTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogVW5zYWZlQ29uZmlnKSB7XG4gICAgc3VwZXIobmV3IENvbmZpZyhjb25maWcpKTtcbiAgICBjb25zdCB7IG1ldGhvZCwgcGFzc3dvcmQsIGhvc3QsIHBvcnQgfSA9IHRoaXM7XG4gICAgY29uc3QgYjY0RW5jb2RlZERhdGEgPSBiNjRFbmNvZGUoYCR7bWV0aG9kfToke3Bhc3N3b3JkfUAke2hvc3R9OiR7cG9ydH1gKTtcbiAgICBjb25zdCBkYXRhTGVuZ3RoID0gYjY0RW5jb2RlZERhdGEubGVuZ3RoO1xuICAgIGxldCBwYWRkaW5nTGVuZ3RoID0gMDtcbiAgICBmb3IgKDsgYjY0RW5jb2RlZERhdGFbZGF0YUxlbmd0aCAtIDEgLSBwYWRkaW5nTGVuZ3RoXSA9PT0gJz0nOyBwYWRkaW5nTGVuZ3RoKyspO1xuICAgIHRoaXMuYjY0RW5jb2RlZERhdGEgPSBwYWRkaW5nTGVuZ3RoID09PSAwID8gYjY0RW5jb2RlZERhdGEgOlxuICAgICAgICBiNjRFbmNvZGVkRGF0YS5zdWJzdHJpbmcoMCwgZGF0YUxlbmd0aCAtIHBhZGRpbmdMZW5ndGgpO1xuICB9XG5cbiAgc3RhdGljIHBhcnNlKHVyaTogc3RyaW5nKSB7XG4gICAgU2hhZG93c29ja3NVUkkudmFsaWRhdGVQcm90b2NvbCh1cmkpO1xuICAgIGNvbnN0IGhhc2hJbmRleCA9IHVyaS5pbmRleE9mKCcjJyk7XG4gICAgbGV0IGI2NEVuZEluZGV4ID0gaGFzaEluZGV4O1xuICAgIGxldCB0YWdTdGFydEluZGV4ID0gaGFzaEluZGV4ICsgMTtcbiAgICBpZiAoaGFzaEluZGV4ID09PSAtMSkge1xuICAgICAgYjY0RW5kSW5kZXggPSB0YWdTdGFydEluZGV4ID0gdXJpLmxlbmd0aDtcbiAgICB9XG4gICAgY29uc3QgdGFnID0gbmV3IFRhZyhkZWNvZGVVUklDb21wb25lbnQodXJpLnN1YnN0cmluZyh0YWdTdGFydEluZGV4KSkpO1xuICAgIGNvbnN0IGI2NEVuY29kZWREYXRhID0gdXJpLnN1YnN0cmluZygnc3M6Ly8nLmxlbmd0aCwgYjY0RW5kSW5kZXgpO1xuICAgIGNvbnN0IGI2NERlY29kZWREYXRhID0gYjY0RGVjb2RlKGI2NEVuY29kZWREYXRhKTtcbiAgICBjb25zdCBhdFNpZ25JbmRleCA9IGI2NERlY29kZWREYXRhLmluZGV4T2YoJ0AnKTtcbiAgICBpZiAoYXRTaWduSW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVSSShgTWlzc2luZyBcIkBcIjogJHtiNjREZWNvZGVkRGF0YX1gKTtcbiAgICB9XG4gICAgY29uc3QgbWV0aG9kQW5kUGFzc3dvcmQgPSBiNjREZWNvZGVkRGF0YS5zdWJzdHJpbmcoMCwgYXRTaWduSW5kZXgpO1xuICAgIGNvbnN0IG1ldGhvZEVuZEluZGV4ID0gbWV0aG9kQW5kUGFzc3dvcmQuaW5kZXhPZignOicpO1xuICAgIGlmIChtZXRob2RFbmRJbmRleCA9PT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBJbnZhbGlkVVJJKGBNaXNzaW5nIHBhc3N3b3JkIHBhcnQ6ICR7bWV0aG9kQW5kUGFzc3dvcmR9YCk7XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZFN0cmluZyA9IG1ldGhvZEFuZFBhc3N3b3JkLnN1YnN0cmluZygwLCBtZXRob2RFbmRJbmRleCk7XG4gICAgY29uc3QgbWV0aG9kID0gbmV3IE1ldGhvZChtZXRob2RTdHJpbmcpO1xuICAgIGNvbnN0IHBhc3N3b3JkU3RhcnRJbmRleCA9IG1ldGhvZEVuZEluZGV4ICsgMTtcbiAgICBjb25zdCBwYXNzd29yZFN0cmluZyA9IG1ldGhvZEFuZFBhc3N3b3JkLnN1YnN0cmluZyhwYXNzd29yZFN0YXJ0SW5kZXgpO1xuICAgIGNvbnN0IHBhc3N3b3JkID0gbmV3IFBhc3N3b3JkKHBhc3N3b3JkU3RyaW5nKTtcbiAgICBjb25zdCBob3N0U3RhcnRJbmRleCA9IGF0U2lnbkluZGV4ICsgMTtcbiAgICBjb25zdCBob3N0QW5kUG9ydCA9IGI2NERlY29kZWREYXRhLnN1YnN0cmluZyhob3N0U3RhcnRJbmRleCk7XG4gICAgY29uc3QgaG9zdEVuZEluZGV4ID0gaG9zdEFuZFBvcnQuaW5kZXhPZignOicpO1xuICAgIGlmIChob3N0RW5kSW5kZXggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVSSShgTWlzc2luZyBwb3J0IHBhcnQ6ICR7aG9zdEFuZFBvcnR9YCk7XG4gICAgfVxuICAgIGNvbnN0IGhvc3QgPSBuZXcgSG9zdChob3N0QW5kUG9ydC5zdWJzdHJpbmcoMCwgaG9zdEVuZEluZGV4KSk7XG4gICAgY29uc3QgcG9ydFN0YXJ0SW5kZXggPSBob3N0RW5kSW5kZXggKyAxO1xuICAgIGNvbnN0IHBvcnRTdHJpbmcgPSBob3N0QW5kUG9ydC5zdWJzdHJpbmcocG9ydFN0YXJ0SW5kZXgpO1xuICAgIGNvbnN0IHBvcnQgPSBuZXcgUG9ydChwb3J0U3RyaW5nKTtcbiAgICByZXR1cm4gbmV3IExlZ2FjeUJhc2U2NFVSSSh7IG1ldGhvZCwgcGFzc3dvcmQsIGhvc3QsIHBvcnQsIHRhZyB9KTtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIGNvbnN0IHsgYjY0RW5jb2RlZERhdGEsIHRhZyB9ID0gdGhpcztcbiAgICBjb25zdCBoYXNoID0gU2hhZG93c29ja3NVUkkuZ2V0SGFzaCh0aGlzKTtcbiAgICByZXR1cm4gYHNzOi8vJHtiNjRFbmNvZGVkRGF0YX0ke2hhc2h9YDtcbiAgfVxufVxuXG4vLyBSZWY6IGh0dHBzOi8vc2hhZG93c29ja3Mub3JnL2VuL3NwZWMvU0lQMDAyLVVSSS1TY2hlbWUuaHRtbFxuLy8gTk9URTogQ3VycmVudGx5IHRoZSBwbHVnaW4gcXVlcnkgcGFyYW0gaXMgcHJlc2VydmVkIG9uIGEgYmVzdC1lZmZvcnQgYmFzaXMuIEl0IGlzIHNpbGVudGx5XG4vLyAgICAgICBkcm9wcGVkIG9uIHBsYXRmb3JtcyB0aGF0IGRvIG5vdCBzdXBwb3J0IHRoZSBmdWxsIHdoYXR3ZyBVUkwgc3RhbmRhcmQgKGNmLiBgc2VhcmNoUGFyYW1zYCkuXG4vLyAgICAgICBSZWY6XG4vLyAgICAgICAgIC0gaHR0cHM6Ly91cmwuc3BlYy53aGF0d2cub3JnLyN1cmwtY2xhc3Ncbi8vICAgICAgICAgLSBodHRwczovL2Nhbml1c2UuY29tLyNmZWF0PXVybHNlYXJjaHBhcmFtc1xuZXhwb3J0IGNsYXNzIFNpcDAwMlVSSSBleHRlbmRzIFNoYWRvd3NvY2tzVVJJIHtcbiAgYjY0RW5jb2RlZFVzZXJJbmZvOiBzdHJpbmc7XG4gIHByaXZhdGUgcGx1Z2luXzogUGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogVW5zYWZlQ29uZmlnKSB7XG4gICAgc3VwZXIobmV3IENvbmZpZyhjb25maWcpKTtcbiAgICBjb25zdCB7IG1ldGhvZCwgcGFzc3dvcmQgfSA9IHRoaXM7XG4gICAgdGhpcy5iNjRFbmNvZGVkVXNlckluZm8gPSBiNjRFbmNvZGUoYCR7bWV0aG9kfToke3Bhc3N3b3JkfWApO1xuICAgIHRoaXMucGx1Z2luID0gKGNvbmZpZyBhcyBTaXAwMDJVUkkpLnBsdWdpbjtcbiAgfVxuXG4gIHNldCBwbHVnaW4ocGx1Z2luOiBQbHVnaW4gfCBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLnBsdWdpbl8gPSBuZXcgUGx1Z2luKHBsdWdpbik7XG4gIH1cblxuICBnZXQgcGx1Z2luKCkge1xuICAgIHJldHVybiB0aGlzLnBsdWdpbl8udG9TdHJpbmcoKTtcbiAgfVxuXG4gIHN0YXRpYyBwYXJzZSh1cmk6IHN0cmluZykge1xuICAgIFNoYWRvd3NvY2tzVVJJLnZhbGlkYXRlUHJvdG9jb2wodXJpKTtcbiAgICAvLyByZXBsYWNlIFwic3NcIiB3aXRoIFwiaHR0cFwiIHNvIFVSTCBidWlsdC1pbiBwYXJzZXIgcGFyc2VzIGl0IGNvcnJlY3RseS5cbiAgICBjb25zdCBpbnB1dEZvclVybFBhcnNlciA9IGBodHRwJHt1cmkuc3Vic3RyaW5nKDIpfWA7XG4gICAgLy8gVGhlIGJ1aWx0LWluIFVSTCBwYXJzZXIgdGhyb3dzIGFzIGRlc2lyZWQgd2hlbiBnaXZlbiBVUklzIHdpdGggaW52YWxpZCBzeW50YXguXG4gICAgY29uc3QgdXJsUGFyc2VyUmVzdWx0ID0gbmV3IFVSTChpbnB1dEZvclVybFBhcnNlcik7XG4gICAgY29uc3QgaG9zdCA9IG5ldyBIb3N0KHVybFBhcnNlclJlc3VsdC5ob3N0bmFtZSk7XG4gICAgY29uc3QgcG9ydCA9IG5ldyBQb3J0KHVybFBhcnNlclJlc3VsdC5wb3J0KTtcbiAgICBjb25zdCB0YWcgPSBuZXcgVGFnKGRlY29kZVVSSUNvbXBvbmVudCh1cmxQYXJzZXJSZXN1bHQuaGFzaC5zdWJzdHJpbmcoMSkpKTtcbiAgICBjb25zdCBiNjRFbmNvZGVkVXNlckluZm8gPSB1cmxQYXJzZXJSZXN1bHQudXNlcm5hbWUucmVwbGFjZSgvJTNEL2csICc9Jyk7XG4gICAgLy8gYmFzZTY0LmRlY29kZSB0aHJvd3MgYXMgZGVzaXJlZCB3aGVuIGdpdmVuIGludmFsaWQgYmFzZTY0IGlucHV0LlxuICAgIGNvbnN0IGI2NERlY29kZWRVc2VySW5mbyA9IGI2NERlY29kZShiNjRFbmNvZGVkVXNlckluZm8pO1xuICAgIGNvbnN0IGNvbG9uSWR4ID0gYjY0RGVjb2RlZFVzZXJJbmZvLmluZGV4T2YoJzonKTtcbiAgICBpZiAoY29sb25JZHggPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgSW52YWxpZFVSSShgTWlzc2luZyBwYXNzd29yZCBwYXJ0OiAke2I2NERlY29kZWRVc2VySW5mb31gKTtcbiAgICB9XG4gICAgY29uc3QgbWV0aG9kU3RyaW5nID0gYjY0RGVjb2RlZFVzZXJJbmZvLnN1YnN0cmluZygwLCBjb2xvbklkeCk7XG4gICAgY29uc3QgbWV0aG9kID0gbmV3IE1ldGhvZChtZXRob2RTdHJpbmcpO1xuICAgIGNvbnN0IHBhc3N3b3JkU3RyaW5nID0gYjY0RGVjb2RlZFVzZXJJbmZvLnN1YnN0cmluZyhjb2xvbklkeCArIDEpO1xuICAgIGNvbnN0IHBhc3N3b3JkID0gbmV3IFBhc3N3b3JkKHBhc3N3b3JkU3RyaW5nKTtcbiAgICBsZXQgcGx1Z2luOiBQbHVnaW47XG4gICAgaWYgKHVybFBhcnNlclJlc3VsdC5zZWFyY2hQYXJhbXMpIHtcbiAgICAgIGNvbnN0IHBsdWdpblN0cmluZyA9IHVybFBhcnNlclJlc3VsdC5zZWFyY2hQYXJhbXMuZ2V0KCdwbHVnaW4nKTtcbiAgICAgIHBsdWdpbiA9IHBsdWdpblN0cmluZyA/IG5ldyBQbHVnaW4ocGx1Z2luU3RyaW5nKSA6IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBTaXAwMDJVUkkoeyBtZXRob2QsIHBhc3N3b3JkLCBob3N0LCBwb3J0LCB0YWcsIHBsdWdpbiB9IGFzIFNpcDAwMlVSSSk7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICBjb25zdCB7IGI2NEVuY29kZWRVc2VySW5mbywgaG9zdCwgcG9ydCwgcGx1Z2luLCB0YWcgfSA9IHRoaXM7XG4gICAgY29uc3QgcXVlcnlTdHJpbmcgPSBwbHVnaW4gPyBgP3BsdWdpbj0ke3BsdWdpbn1gIDogJyc7XG4gICAgY29uc3QgaGFzaCA9IFNoYWRvd3NvY2tzVVJJLmdldEhhc2godGhpcyk7XG4gICAgcmV0dXJuIGBzczovLyR7YjY0RW5jb2RlZFVzZXJJbmZvfUAke2hvc3R9OiR7cG9ydH0vJHtxdWVyeVN0cmluZ30ke2hhc2h9YDtcbiAgfVxufVxuIl19
